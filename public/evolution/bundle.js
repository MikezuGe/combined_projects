!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=56)}({56:function(t,e,i){"use strict";i.r(e);class n{constructor(){this.cell=null}die(){this.cell.removeEntity()}}const{random:o,floor:r}=Math,s=(t,e)=>r(o()*(e-t))+t,a="ENTITY_PLANT";class l extends n{constructor(){super(),this.size=2,this.timeToLive=s(this.TIME_TO_LIVE_MIN,this.TIME_TO_LIVE_MAX),this.timeToCanGrow=s(this.TIME_TO_GROW_MIN,this.TIME_TO_GROW_MAX),this.timeToCanBreed=s(this.TIME_TO_BREED_MIN,this.TIME_TO_BREED_MAX)}grow(){this.size<this.ENTITY_MAX_SIZE&&(this.size++,this.timeToCanGrow=s(this.TIME_TO_GROW_MIN,this.TIME_TO_GROW_MAX))}breed(){const t=this.cell.getEmptyAdjacentCell();t&&(t.setEntity(new this.constructor),this.size-=this.SHRINK_ON_BREED,this.timeToCanBreed=s(this.TIME_TO_BREED_MIN,this.TIME_TO_BREED_MAX))}update(){if(--this.timeToLive<=0)return this.die();this.timeToCanGrow<=0?this.grow():this.timeToCanGrow--,this.timeToCanBreed<=0?this.breed():this.timeToCanBreed--}}l.prototype.ENTITY_TYPE=a,l.prototype.ENTITY_COLOR=0,l.prototype.TIME_TO_LIVE_MIN=800,l.prototype.TIME_TO_LIVE_MAX=1e3,l.prototype.TIME_TO_GROW_MIN=10,l.prototype.TIME_TO_GROW_MAX=20,l.prototype.TIME_TO_BREED_MIN=50,l.prototype.TIME_TO_BREED_MAX=100,l.prototype.ENTITY_MAX_SIZE=10,l.prototype.SIZE_TO_BREED=6,l.prototype.SHRINK_ON_BREED=4;const{random:h,floor:_}=Math,c=(t,e)=>_(h()*(e-t))+t;class T extends n{constructor(){super(),this.size=2,this.satiation=3,this.timeToLive=c(this.TIME_TO_LIVE_MIN,this.TIME_TO_LIVE_MAX),this.timeToCanGrow=c(this.TIME_TO_GROW_MIN,this.TIME_TO_GROW_MAX),this.timeToCanBreed=c(this.TIME_TO_BREED_MIN,this.TIME_TO_BREED_MAX),this.direction=null}findFood(){let t=null,e=1/0;for(let i=0;i<4;i++){let n=this.adjacentCells[i],o=1;if(n)for(;n=n.adjacentCells[i];)if(o++,n.entity){if(n.entity.ENTITY_TYPE!==a)break;o<e&&(e=o,t=i)}}if(e<1/0)return t}move(){}eat(){}grow(){this.size<this.ENTITY_MAX_SIZE&&(this.size++,this.timeToCanGrow=c(this.TIME_TO_GROW_MIN,this.TIME_TO_GROW_MAX))}breed(){const t=this.cell.getEmptyAdjacentCell();t&&(t.setEntity(new this.constructor),this.size-=this.SHRINK_ON_BREED,this.timeToCanBreed=c(this.TIME_TO_BREED_MIN,this.TIME_TO_BREED_MAX))}update(){if(--this.timeToLive<=0)return this.die();this.timeToCanGrow<=0?this.grow():this.timeToCanGrow--,this.timeToCanBreed<=0?this.breed():this.timeToCanBreed--,this.direction?this.move():this.satiation<this.SATIATION_TO_EAT&&(this.direction=this.findFood(),this.move())}}T.prototype.ENTITY_TYPE="ENTITY_HERBIVORE",T.prototype.ENTITY_COLOR=1,T.prototype.TIME_TO_LIVE_MIN=3e3,T.prototype.TIME_TO_LIVE_MAX=3500,T.prototype.TIME_TO_GROW_MIN=150,T.prototype.TIME_TO_GROW_MAX=200,T.prototype.TIME_TO_BREED_MIN=800,T.prototype.TIME_TO_BREED_MAX=1e3,T.prototype.SATIATION_TO_EAT=8,T.prototype.ENTITY_MAX_SIZE=10,T.prototype.SIZE_TO_BREED=8,T.prototype.SHRINK_ON_BREED=5;const d={ENTITY_PLANT:a,ENTITY_HERBIVORE:"ENTITY_HERBIVORE"},{ENTITY_PLANT:E,ENTITY_HERBIVORE:f}=d,{random:u,floor:p}=Math;class I{constructor(t,e,i){this.cellNumber=t,this.cellType=e,this.renderingPosition=i,this.adjacentCells=[],this.entity=null}getEmptyAdjacentCell(){const{adjacentCells:t,entity:{ENTITY_TYPE:e}}=this,i=t.filter(t=>{if(!t)return!1;if(!t.entity)return!0;switch(e){case f:return t.entity.ENTITY_TYPE===E;default:return!1}});return i.length?i[p(u()*i.length)]:null}setEntity(t){this.entity&&this.removeEntity(),this.entity=t,t.cell=this}removeEntity(){this.entity.cell=null,this.entity=null}update(){this.entity&&this.entity.update()}}const{floor:y}=Math;const m=document.createElement("canvas"),O=m.getContext("webgl2");document.getElementById("root").appendChild(m);const M=O.createShader(O.VERTEX_SHADER),R=O.createShader(O.FRAGMENT_SHADER);O.shaderSource(M,"#version 300 es\nin vec2 a_position;\nin float a_color;\nin float a_alpha;\nin float a_size;\n\nvec3 getColor () {\n  switch (int(a_color)) {\n    case 0: return vec3(0.0, 1.0, 0.0);\n    case 1: return vec3(1.0, 0.75, 0.8);\n    case 2: return vec3(1.0, 0.0, 0.0);\n    default: return vec3(0.0, 0.0, 0.0);\n  }\n}\n\nout vec4 color;\nvoid main () {\n  color = vec4(getColor(), a_alpha);\n  gl_Position = vec4(a_position.x, -a_position.y, 0.0, 1.0);\n  gl_PointSize = a_size;\n}\n"),O.shaderSource(R,"#version 300 es\nprecision mediump float;\n\nin vec4 color;\n\nout vec4 fragColor;\nvoid main () {\n  if (color.w == 0.0) {\n    discard;\n  }\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  float r = dot(cxy, cxy);\n  if (r > 1.0) {\n    discard;\n  }\n  float delta = fwidth(r);\n  float alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n  fragColor = vec4(color.xyz * alpha, color.w);\n}\n"),O.compileShader(M),O.compileShader(R);const g=O.getShaderInfoLog(M);console.log("vs compile err: ",g);const A=O.getShaderInfoLog(R);console.log("fs compile err: ",A);const b=O.createProgram();O.attachShader(b,M),O.attachShader(b,R),O.linkProgram(b),O.useProgram(b);(t=>{const e=document.createElement("style");e.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(e),t||(t="\n    * {\n      font-family: 'Ubuntu', sans-serif;\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      font-size: 16px;\n    }\n    \n    html body {\n      height: 100vh;\n      width: 100vw;\n      overflow: hidden;\n    }\n    \n    #root {\n      width: 100%;\n      height: 100%;\n    }\n    \n    canvas {\n      //width: 100%;\n      //height: 100%;\n      background: gray;\n    }\n    "),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))})("\n* {\n  font-family: 'Ubuntu', sans-serif;\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  font-size: 16px;\n}\n\nhtml body {\n  height: 100vh;\n  width: 100vw;\n  overflow: hidden;\n}\n\n#root {\n  width: 100%;\n  height: 100%;\n}\n\ncanvas {\n  //width: 100%;\n  //height: 100%;\n  background: gray;\n}\n"),window.addEventListener("keyup",t=>{"p"===t.key?v+=v<20?1:0:"o"===t.key&&(v-=v>0?1:0)},!1);let v=3;const B=new class{constructor(t,e){if(t<3||e<3)throw new Error("Too small world, must be at least 3x3");this.width=t,this.height=e,this.dimension=t*e,this.field=[],this.setupFieldCells(),this.field[0].setEntity(new l),setTimeout(()=>{this.field[100].setEntity(new T)},1e4)}setupFieldCells(){const{field:t,width:e,height:i,dimension:n,getCellType:o}=this;for(let r=0;r<n;r++)t[r]=new I(r,o(r,e,n),{x:(r%e*10+5)/10/e*2-1,y:(10*y(r/e)+5)/10/i*2-1});for(let i=0;i<n;i++){const n=[];n[0]=t[i-e]?t[i-e]:null,n[1]=(i+1)%e!=0&&t[i+1]?t[i+1]:null,n[2]=t[i+e]?t[i+e]:null,n[3]=i%e!=0&&t[i-1]?t[i-1]:null,t[i].adjacentCells=n}}getCellType(t,e,i){return 0===t?"top-left":t+1===e?"top-right":t+e===i?"bottom-left":t+1===i?"bottom-right":t<e?"top":t+e+1>i?"bottom":t%e==0?"left":(t+1)%e==0?"right":"normal"}update(){const{field:t}=this;for(const e of t)e.update()}}(190,75),N=new class{constructor(){this.vertices=[],this.varying=[],this.positionBuffer=O.createBuffer(),this.varyingBuffer=O.createBuffer(),this.vertexAttributes={a_position:{buffer:this.positionBuffer,attribute:O.getAttribLocation(b,"a_position"),type:O.FLOAT,size:2,stride:8,offset:0},a_color:{buffer:this.varyingBuffer,attribute:O.getAttribLocation(b,"a_color"),type:O.FLOAT,size:1,stride:12,offset:0},a_alpha:{buffer:this.varyingBuffer,attribute:O.getAttribLocation(b,"a_alpha"),type:O.FLOAT,size:1,stride:12,offset:4},a_size:{buffer:this.varyingBuffer,attribute:O.getAttribLocation(b,"a_size"),type:O.FLOAT,size:1,stride:12,offset:8}}}setupWorldRender(t){m.width=10*t.width,m.height=10*t.height,O.viewport(0,0,m.width,m.height);const{vertices:e,varying:i}=this;for(const{renderingPosition:n}of t.field)e.push(n.x,n.y),i.push(0,0,0);O.bindBuffer(O.ARRAY_BUFFER,this.positionBuffer),O.bufferData(O.ARRAY_BUFFER,new Float32Array(e),O.STATIC_DRAW),O.bindBuffer(O.ARRAY_BUFFER,this.varyingBuffer),O.bufferData(O.ARRAY_BUFFER,new Float32Array(i),O.DYNAMIC_DRAW);for(const{buffer:t,attribute:e,size:i,type:n,stride:o,offset:r}of Object.values(this.vertexAttributes))O.bindBuffer(O.ARRAY_BUFFER,t),O.enableVertexAttribArray(e),O.vertexAttribPointer(e,i,n,!1,o,r);O.clearColor(.4,.4,.4,1),O.clear(O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT)}renderWorld({field:t,dimension:e}){O.clearColor(.4,.4,.4,1),O.clear(O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT);const{varying:i}=this;for(const{entity:e,cellNumber:n}of t){const t=3*n;e?(i[t+0]=e.ENTITY_COLOR,i[t+1]=1,i[t+2]=e.size):i[t+1]=0}O.bufferData(O.ARRAY_BUFFER,new Float32Array(i),O.DYNAMIC_DRAW),O.drawArrays(O.POINTS,0,e)}};N.setupWorldRender(B);const w=()=>{requestAnimationFrame(w);for(let t=0;t<v;t++)B.update();N.renderWorld(B)};requestAnimationFrame(w)}});