!function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=56)}([,,,function(t,e,r){"use strict";var s=r(12),n=r(29),i=Object.prototype.toString;function o(t){return"[object Array]"===i.call(t)}function a(t){return null!==t&&"object"==typeof t}function h(t){return"[object Function]"===i.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.call(null,t[n],n,t)}t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===i.call(t)},isBuffer:n,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===i.call(t)},isFile:function(t){return"[object File]"===i.call(t)},isBlob:function(t){return"[object Blob]"===i.call(t)},isFunction:h,isStream:function(t){return a(t)&&h(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function t(){var e={};function r(r,s){"object"==typeof e[s]&&"object"==typeof r?e[s]=t(e[s],r):e[s]=r}for(var s=0,n=arguments.length;s<n;s++)u(arguments[s],r);return e},extend:function(t,e,r){return u(e,function(e,n){t[n]=r&&"function"==typeof e?s(e,r):e}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},,function(t,e,r){t.exports=r(28)},,function(t,e,r){"use strict";(function(e){var s=r(3),n=r(31),i={"Content-Type":"application/x-www-form-urlencoded"};function o(t,e){!s.isUndefined(t)&&s.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var a,h={adapter:("undefined"!=typeof XMLHttpRequest?a=r(13):void 0!==e&&(a=r(13)),a),transformRequest:[function(t,e){return n(e,"Content-Type"),s.isFormData(t)||s.isArrayBuffer(t)||s.isBuffer(t)||s.isStream(t)||s.isFile(t)||s.isBlob(t)?t:s.isArrayBufferView(t)?t.buffer:s.isURLSearchParams(t)?(o(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):s.isObject(t)?(o(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};h.headers={common:{Accept:"application/json, text/plain, */*"}},s.forEach(["delete","get","head"],function(t){h.headers[t]={}}),s.forEach(["post","put","patch"],function(t){h.headers[t]=s.merge(i)}),t.exports=h}).call(this,r(10))},,,function(t,e){var r,s,n=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(t){s=o}}();var h,u=[],c=!1,m=-1;function l(){c&&h&&(c=!1,h.length?u=h.concat(u):m=-1,u.length&&d())}function d(){if(!c){var t=a(l);c=!0;for(var e=u.length;e;){for(h=u,u=[];++m<e;)h&&h[m].run();m=-1,e=u.length}h=null,c=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new f(t,e)),1!==u.length||c||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},,function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),s=0;s<r.length;s++)r[s]=arguments[s];return t.apply(e,r)}}},function(t,e,r){"use strict";var s=r(3),n=r(32),i=r(34),o=r(35),a=r(36),h=r(14),u="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||r(37);t.exports=function(t){return new Promise(function(e,c){var m=t.data,l=t.headers;s.isFormData(m)&&delete l["Content-Type"];var d=new XMLHttpRequest,f="onreadystatechange",p=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in d||a(t.url)||(d=new window.XDomainRequest,f="onload",p=!0,d.onprogress=function(){},d.ontimeout=function(){}),t.auth){var g=t.auth.username||"",w=t.auth.password||"";l.Authorization="Basic "+u(g+":"+w)}if(d.open(t.method.toUpperCase(),i(t.url,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,d[f]=function(){if(d&&(4===d.readyState||p)&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in d?o(d.getAllResponseHeaders()):null,s={data:t.responseType&&"text"!==t.responseType?d.response:d.responseText,status:1223===d.status?204:d.status,statusText:1223===d.status?"No Content":d.statusText,headers:r,config:t,request:d};n(e,c,s),d=null}},d.onerror=function(){c(h("Network Error",t,null,d)),d=null},d.ontimeout=function(){c(h("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",d)),d=null},s.isStandardBrowserEnv()){var y=r(38),x=(t.withCredentials||a(t.url))&&t.xsrfCookieName?y.read(t.xsrfCookieName):void 0;x&&(l[t.xsrfHeaderName]=x)}if("setRequestHeader"in d&&s.forEach(l,function(t,e){void 0===m&&"content-type"===e.toLowerCase()?delete l[e]:d.setRequestHeader(e,t)}),t.withCredentials&&(d.withCredentials=!0),t.responseType)try{d.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&d.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){d&&(d.abort(),c(t),d=null)}),void 0===m&&(m=null),d.send(m)})}},function(t,e,r){"use strict";var s=r(33);t.exports=function(t,e,r,n,i){var o=new Error(t);return s(o,e,r,n,i)}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";function s(t){this.message=t}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,t.exports=s},,,,,,,,,,,,function(t,e,r){"use strict";var s=r(3),n=r(12),i=r(30),o=r(7);function a(t){var e=new i(t),r=n(i.prototype.request,e);return s.extend(r,i.prototype,e),s.extend(r,e),r}var h=a(o);h.Axios=i,h.create=function(t){return a(s.merge(o,t))},h.Cancel=r(16),h.CancelToken=r(44),h.isCancel=r(15),h.all=function(t){return Promise.all(t)},h.spread=r(45),t.exports=h,t.exports.default=h},function(t,e){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(r(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,r){"use strict";var s=r(7),n=r(3),i=r(39),o=r(40);function a(t){this.defaults=t,this.interceptors={request:new i,response:new i}}a.prototype.request=function(t){"string"==typeof t&&(t=n.merge({url:arguments[0]},arguments[1])),(t=n.merge(s,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[o,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},n.forEach(["delete","get","head","options"],function(t){a.prototype[t]=function(e,r){return this.request(n.merge(r||{},{method:t,url:e}))}}),n.forEach(["post","put","patch"],function(t){a.prototype[t]=function(e,r,s){return this.request(n.merge(s||{},{method:t,url:e,data:r}))}}),t.exports=a},function(t,e,r){"use strict";var s=r(3);t.exports=function(t,e){s.forEach(t,function(r,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[s])})}},function(t,e,r){"use strict";var s=r(14);t.exports=function(t,e,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?e(s("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},function(t,e,r){"use strict";t.exports=function(t,e,r,s,n){return t.config=e,r&&(t.code=r),t.request=s,t.response=n,t}},function(t,e,r){"use strict";var s=r(3);function n(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var i;if(r)i=r(e);else if(s.isURLSearchParams(e))i=e.toString();else{var o=[];s.forEach(e,function(t,e){null!=t&&(s.isArray(t)?e+="[]":t=[t],s.forEach(t,function(t){s.isDate(t)?t=t.toISOString():s.isObject(t)&&(t=JSON.stringify(t)),o.push(n(e)+"="+n(t))}))}),i=o.join("&")}return i&&(t+=(-1===t.indexOf("?")?"?":"&")+i),t}},function(t,e,r){"use strict";var s=r(3),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,i,o={};return t?(s.forEach(t.split("\n"),function(t){if(i=t.indexOf(":"),e=s.trim(t.substr(0,i)).toLowerCase(),r=s.trim(t.substr(i+1)),e){if(o[e]&&n.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([r]):o[e]?o[e]+", "+r:r}}),o):o}},function(t,e,r){"use strict";var s=r(3);t.exports=s.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(t){var s=t;return e&&(r.setAttribute("href",s),s=r.href),r.setAttribute("href",s),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=n(window.location.href),function(e){var r=s.isString(e)?n(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(){this.message="String contains an invalid character"}n.prototype=new Error,n.prototype.code=5,n.prototype.name="InvalidCharacterError",t.exports=function(t){for(var e,r,i=String(t),o="",a=0,h=s;i.charAt(0|a)||(h="=",a%1);o+=h.charAt(63&e>>8-a%1*8)){if((r=i.charCodeAt(a+=.75))>255)throw new n;e=e<<8|r}return o}},function(t,e,r){"use strict";var s=r(3);t.exports=s.isStandardBrowserEnv()?{write:function(t,e,r,n,i,o){var a=[];a.push(t+"="+encodeURIComponent(e)),s.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";var s=r(3);function n(){this.handlers=[]}n.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){s.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=n},function(t,e,r){"use strict";var s=r(3),n=r(41),i=r(15),o=r(7),a=r(42),h=r(43);function u(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return u(t),t.baseURL&&!a(t.url)&&(t.url=h(t.baseURL,t.url)),t.headers=t.headers||{},t.data=n(t.data,t.headers,t.transformRequest),t.headers=s.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),s.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||o.adapter)(t).then(function(e){return u(t),e.data=n(e.data,e.headers,t.transformResponse),e},function(e){return i(e)||(u(t),e&&e.response&&(e.response.data=n(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,r){"use strict";var s=r(3);t.exports=function(t,e,r){return s.forEach(r,function(r){t=r(t,e)}),t}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var s=r(16);function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new s(t),e(r.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n(function(e){t=e}),cancel:t}},t.exports=n},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},,,,,,,,,,,function(t,e,r){"use strict";r.r(e);var s={};r.r(s),r.d(s,"Model",function(){return O}),r.d(s,"Camera",function(){return I});var n=t=>t.charAt(0).toUpperCase()+t.slice(1);var i=t=>{const e=document.createElement("style");e.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(e),t||(t="\n    * {\n      font-family: 'Ubuntu', sans-serif;\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      font-size: 16px;\n    }\n    \n    html body {\n      height: 100vh;\n      width: 100vw;\n      overflow: hidden;\n    }\n    \n    #root {\n      width: 100%;\n      height: 100%;\n    }\n    \n    canvas {\n      //width: 100%;\n      //height: 100%;\n      background: gray;\n    }\n    "),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))};class o{constructor(t=!1,e=!1){this.subscribers=[],this.invoke=this.getInvoker(t,e)}subscribe(t){this.subscribers.includes(t)||this.subscribers.push(t)}unsubscribe(t){this.subscribers.includes(t)&&this.subscribers.splice(this.subscribers.indexOf(t))}getInvoker(t,e){return t&&e?t=>{t.preventDefault(),t.stopPropagation(),this.subscribers.forEach(e=>e(t))}:t?t=>{t.preventDefault(),this.subscribers.forEach(e=>e(t))}:e?t=>{t.stopPropagation(),this.subscribers.forEach(e=>e(t))}:t=>{this.subscribers.forEach(e=>e(t))}}}const a=new o,h=new o(!0,!0),u=new o(!1,!0),c=new o(!0,!0),m=new o(!0,!0),l=new o(!0,!0);function d(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}window.addEventListener("resize",a.invoke,!1),window.addEventListener("keyup",h.invoke,!1),window.addEventListener("keydown",u.invoke,!1),window.addEventListener("mouseup",c.invoke,!1),window.addEventListener("mousedown",m.invoke,!1),window.addEventListener("mousemove",l.invoke,!1);const{abs:f}=Math;const p=new class{constructor(){d(this,"keyup",t=>{this.keys.includes(t.key)&&this.keys.splice(this.keys.indexOf(t.key),1)}),d(this,"keydown",t=>{this.keys.includes(t.key)||this.keys.push(t.key)}),d(this,"mouseup",t=>{const e=this[`mouse${t.button}`];e.press=!1,e.hold=!1,e.drag=!1,e.sx=null,e.sx=null,e.dx=null,e.dy=null;for(let t=0;t<3;t++)if(this[`mouse${t}`].press)return;this.mouse.press=!1}),d(this,"mousedown",t=>{const e=this[`mouse${t.button}`];this.mouse.press=!0,e.press=!0,e.sx=t.clientX,e.sy=t.clientY}),d(this,"mousemove",({clientX:t,clientY:e})=>{const r=this.mouse;if(r.dx=t-r.x,r.dy=r.y-e,r.x=t,r.y=e,this.mouse.press)for(let r=0;r<3;r++){const s=this[`mouse${r}`];s.press&&(s.hold=!0,s.dx=t-s.sx,s.dy=e-s.sy,!s.drag&&(f(s.dx)>20||f(s.dy)>20)&&(s.drag=!0))}}),this.mouse={press:!1,x:null,y:null,dx:0,dy:0},this.mouse0={},this.mouse1={},this.mouse2={};for(let t=0;t<3;t++)this[`mouse${t}`].press=!1,this[`mouse${t}`].hold=!1,this[`mouse${t}`].drag=!1,this[`mouse${t}`].sx=null,this[`mouse${t}`].sx=null,this[`mouse${t}`].dx=null,this[`mouse${t}`].dy=null;this.keys=[]}getKeys(){return this.keys}getMouse(){return this.mouse}getMouse0(){return this.mouse0}getMouse1(){return this.mouse1}getMouse2(){return this.mouse2}update(){const t=this.mouse;t.dx=0,t.dy=0}};u.subscribe(p.keydown),h.subscribe(p.keyup),c.subscribe(p.mouseup),m.subscribe(p.mousedown),l.subscribe(p.mousemove);var g=p;class w{constructor(t,e,r){this.geometry=t||null,this.material=e||null,this.worldTransforms=[r]}}class y{constructor(t,e){this.mesh=null,this.vertexOffset=t,this.vertexCount=e}}const{sqrt:x}=Math;class v{static get zero(){return new v(0,0)}static get up(){return new v(0,1)}static get down(){return new v(0,-1)}static get left(){return new v(-1,0)}static get right(){return new v(1,0)}static fromArray(t){return new v(...t)}constructor(t,e){this.x=t||0,this.y=e||0}get toArray(){return[this.x,this.y]}get toFloat32Array(){return new Float32Array([this.x,this.y])}get clone(){return new v(this.x,this.y)}get len(){return x(this.x*this.x+this.y*this.y)}get lenSqrt(){return this.x*this.x+this.y*this.y}get normalize(){let t=x(this.x*this.x+this.y*this.y);return t>0?(t=1/t,new v(this.x*t,this.y*t)):new v(0,0)}add(t){return new v(this.x+t.x,this.y+t.y)}sub(t){return new v(this.x-t.x,this.y-t.y)}scale(t){return new v(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}getAngle(t){return this.normalize.dot(t.normalize)}invert(){return new v(-this.x,-this.y)}}const{sqrt:b}=Math;class _{static get zero(){return new _(0,0,0)}static get up(){return new _(0,1,0)}static get down(){return new _(0,-1,0)}static get left(){return new _(-1,0,0)}static get right(){return new _(1,0,0)}static get forward(){return new _(0,0,1)}static get backward(){return new _(0,0,-1)}static get one(){return new _(1,1,1)}static fromArray(t){return new _(...t)}static fromQuat(t){const e=this.x,r=this.y,s=this.z,n=t.x,i=t.y,o=t.z,a=t.w,h=a*e+i*s-o*r,u=a*r+o*e-n*s,c=a*s+n*r-i*e,m=-n*e-i*r-o*s;return new _(h*a+m*-n+u*-o-c*-i,u*a+m*-i+c*-n-h*-o,c*a+m*-o+h*-i-u*-n)}static fromMat4(t){return new _(t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z)}constructor(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}get forward(){return this.normalize}get backward(){return this.normalize.invert}get left(){return this.normalize.cross(_.up).normalize}get right(){return this.normalize.cross(_.up).normalize.invert}get down(){return this.normalize.cross(this.left).normalize}get up(){return this.normalize.cross(this.left).normalize.invert}get toArray(){return[this.x,this.y,this.z]}get toFloat32Array(){return new Float32Array([this.x,this.y,this.z])}get clone(){return new _(this.x,this.y,this.z)}get len(){return b(this.x*this.x+this.y*this.y+this.z*this.z)}get lenSqrt(){return this.x*this.x+this.y*this.y+this.z*this.z}get normalize(){let t=b(this.x*this.x+this.y*this.y+this.z*this.z);return t>0?(t=1/t,new _(this.x*t,this.y*t,this.z*t)):new _(0,0,0)}get invert(){return new _(-this.x,-this.y,-this.z)}add(t){return new _(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new _(this.x-t.x,this.y-t.y,this.z-t.z)}scale(t){return new _(this.x*t,this.y*t,this.z*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new _(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}lerp(t,e){return new _(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e,this.z+(t.z-this.z)*e)}getNormal(t,e){return this.sub(t).cross(this.sub(e)).normalize}getAngle(t){return this.normalize.dot(t.normalize)}}const{sqrt:T}=Math;class E{static get identity(){return new E(1,0,0,0,1,0,0,0,1)}static fromArray(t){return new E(...t)}constructor(t,e,r,s,n,i,o,a,h){this.m00=t,this.m01=e,this.m02=r,this.m10=s,this.m11=n,this.m12=i,this.m20=o,this.m21=a,this.m22=h}get clone(){return new E(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}get toArray(){return[this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22]}get toFloat32Array(){return new Float32Array([this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22])}get toMat4(){return new z(this.m00,this.m01,this.m02,0,this.m10,this.m11,this.m12,0,this.m20,this.m21,this.m22,0,0,0,0,1)}get toQuat(){const t=this.m00+this.m11+this.m22;let e;return t>0?(e=.5/T(t+1),new F(.25/e,(this.m21-this.m12)*e,(this.m02-this.m20)*e)):this.m00>this.m11&&this.m00>this.m22?(e=2*T(1+this.m00-this.m11-this.m22),new F((this.m21-this.m12)/e,.25*e,(this.m01+this.m10)/e,(this.m02+this.m20)/e)):this.m11>this.m22?(e=2*T(1+this.m11-this.m00-this.m22),new F((this.m02-this.m20)/e,(this.m01+this.m10)/e,.25*e,(this.m12+this.m21)/e)):(e=2*T(1+this.m22-this.m00-this.m11),new F((this.m10-this.m01)/e,(this.m02+this.m20)/e,(this.m12+this.m21)/e))}get invert(){const{m00:t,m01:e,m02:r,m10:s,m11:n,m12:i,m20:o,m21:a,m22:h}=this,u=h*n-i*a,c=-h*s+i*o,m=a*s-n*o;let l=t*u+e*c+r*m;if(0===l)throw new Error(`Cannot invert matrix ${this}`);return new E(u*(l=1/l),(-h*e+r*a)*l,(i*e-r*n)*l,c*l,(h*t-r*o)*l,(-i*t+r*s)*l,m*l,(-a*t+e*o)*l,(n*t-e*s)*l)}get transpose(){return new E(this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22)}multiplyVector(t){return new E(this.m00*t.x+this.m01*t.y+this.m02*t.z,this.m10*t.x+this.m11*t.y+this.m12*t.z,this.m20*t.x+this.m21*t.y+this.m22*t.z)}add(t){return new E(this.m00+t.m00,this.m01+t.m01,this.m02+t.m02,this.m10+t.m10,this.m11+t.m11,this.m12+t.m12,this.m20+t.m20,this.m21+t.m21,this.m22+t.m22)}sub(t){return new E(this.m00-t.m00,this.m01-t.m01,this.m02-t.m02,this.m10-t.m10,this.m11-t.m11,this.m12-t.m12,this.m20-t.m20,this.m21-t.m21,this.m22-t.m22)}mul(t){const e=this.m00,r=this.m01,s=this.m02,n=this.m10,i=this.m11,o=this.m12,a=this.m20,h=this.m21,u=this.m22,c=t.m00,m=t.m01,l=t.m02,d=t.m10,f=t.m11,p=t.m12,g=t.m20,w=t.m21,y=t.m22;return new E(e*c+r*d+s*g,e*m+r*f+s*w,e*l+r*p+s*y,n*c+i*d+o*g,n*m+i*f+o*w,n*l+i*p+o*y,a*c+h*d+u*g,a*m+h*f+u*w,a*l+h*p+u*y)}}const{sin:A,cos:R,tan:S}=Math;class z{static get identity(){return new z(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static fromArray(t){return new z(...t)}static perspective(t,e,r,s){const n=1/S(t/2),i=1/(r-s);return new z(n/e,0,0,0,0,n,0,0,0,0,(r+s)*i,-1,0,0,r*s*i*2,0)}static orthographic(t,e,r,s,n,i){const o=1/(t-e),a=1/(r-s),h=1/(n-i);return new z(2*o,0,0,0,0,2*a,0,0,0,0,2*h,0,(t+e)*o,(s+r)*a,(i+n)*h,1)}static translate(t,e,r){return new z(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1)}static rotateX(t){const e=R(t),r=A(t);return new z(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1)}static rotateY(t){const e=R(t),r=A(t);return new z(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1)}static rotateZ(t){const e=R(t),r=A(t);return new z(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1)}static scale(t,e,r){return new z(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)}constructor(t,e,r,s,n,i,o,a,h,u,c,m,l,d,f,p){this.m00=t||0,this.m01=e||0,this.m02=r||0,this.m03=s||0,this.m10=n||0,this.m11=i||0,this.m12=o||0,this.m13=a||0,this.m20=h||0,this.m21=u||0,this.m22=c||0,this.m23=m||0,this.m30=l||0,this.m31=d||0,this.m32=f||0,this.m33=p||0}get clone(){return new z(this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33)}get toArray(){return[this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33]}get toFloat32Array(){return new Float32Array([this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33])}get toMat3(){return new E(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}get toQuat(){return this.toMat3.toQuat}get invert(){const{m00:t,m01:e,m02:r,m03:s,m10:n,m11:i,m12:o,m13:a,m20:h,m21:u,m22:c,m23:m,m30:l,m31:d,m32:f,m33:p}=this,g=i*c*p-i*m*f-u*o*p+u*a*f+d*o*m-d*a*c,w=-n*c*p+n*m*f+h*o*p-h*a*f-l*o*m+l*a*c,y=n*u*p-n*m*d-h*i*p+h*a*d+l*i*m-l*a*u,x=-n*u*f+n*c*d+h*i*f-h*o*d-l*i*c+l*o*u;let v=t*g+e*w+r*y+s*x;if(0===v)throw new Error(`Cannot invert matrix ${this}`);return new z((v=1/v)*g,v*-e*c*p+e*m*f+u*r*p-u*s*f-d*r*m+d*s*c,v*e*o*p-e*a*f-i*r*p+i*s*f+d*r*a-d*s*o,v*-e*o*m+e*a*c+i*r*m-i*s*c-u*r*a+u*s*o,v*w,v*t*c*p-t*m*f-h*r*p+h*s*f+l*r*m-l*s*c,v*-t*o*p+t*a*f+n*r*p-n*s*f-l*r*a+l*s*o,v*t*o*m-t*a*c-n*r*m+n*s*c+h*r*a-h*s*o,v*y,v*-t*u*p+t*m*d+h*e*p-h*s*d-l*e*m+l*s*u,v*t*i*p-t*a*d-n*e*p+n*s*d+l*e*a-l*s*i,v*-t*i*m+t*a*u+n*e*m-n*s*u-h*e*a+h*s*i,v*x,v*t*u*f-t*c*d-h*e*f+h*r*d+l*e*c-l*r*u,v*-t*i*f+t*o*d+n*e*f-n*r*d-l*e*o+l*r*i,v*t*i*c-t*o*u-n*e*c+n*r*u+h*e*o-h*r*i)}get transpose(){return new z(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33)}get translation(){return new _(this.m30,this.m31,this.m32)}get scale(){return new _(new _(this.m00,this.m10,this.m20).len,new _(this.m01,this.m11,this.m21).len,new _(this.m02,this.m12,this.m22).len)}get rotation(){return new E(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}lookAt(t,e){const r=new _(this.m30,this.m31,this.m32),s=r.sub(t).normalize,n=e.cross(s),i=s.cross(n);return new z(n.x,n.y,n.z,0,i.x,i.y,i.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,1)}add(t){return new z(this.m00+t.m00,this.m01+t.m01,this.m02+t.m02,this.m03+t.m03,this.m10+t.m10,this.m11+t.m11,this.m12+t.m12,this.m13+t.m13,this.m20+t.m20,this.m21+t.m21,this.m22+t.m22,this.m23+t.m23,this.m30+t.m30,this.m31+t.m31,this.m32+t.m32,this.m33+t.m33)}sub(t){return new z(this.m00-t.m00,this.m01-t.m01,this.m02-t.m02,this.m03-t.m03,this.m10-t.m10,this.m11-t.m11,this.m12-t.m12,this.m13-t.m13,this.m20-t.m20,this.m21-t.m21,this.m22-t.m22,this.m23-t.m23,this.m30-t.m30,this.m31-t.m31,this.m32-t.m32,this.m33-t.m33)}mul(t){return new z(t.m00*this.m00+t.m01*this.m10+t.m02*this.m20+t.m03*this.m30,t.m00*this.m01+t.m01*this.m11+t.m02*this.m21+t.m03*this.m31,t.m00*this.m02+t.m01*this.m12+t.m02*this.m22+t.m03*this.m32,t.m00*this.m03+t.m01*this.m13+t.m02*this.m23+t.m03*this.m33,t.m10*this.m00+t.m11*this.m10+t.m12*this.m20+t.m13*this.m30,t.m10*this.m01+t.m11*this.m11+t.m12*this.m21+t.m13*this.m31,t.m10*this.m02+t.m11*this.m12+t.m12*this.m22+t.m13*this.m32,t.m10*this.m03+t.m11*this.m13+t.m12*this.m23+t.m13*this.m33,t.m20*this.m00+t.m21*this.m10+t.m22*this.m20+t.m23*this.m30,t.m20*this.m01+t.m21*this.m11+t.m22*this.m21+t.m23*this.m31,t.m20*this.m02+t.m21*this.m12+t.m22*this.m22+t.m23*this.m32,t.m20*this.m03+t.m21*this.m13+t.m22*this.m23+t.m23*this.m33,t.m30*this.m00+t.m31*this.m10+t.m32*this.m20+t.m33*this.m30,t.m30*this.m01+t.m31*this.m11+t.m32*this.m21+t.m33*this.m31,t.m30*this.m02+t.m31*this.m12+t.m32*this.m22+t.m33*this.m32,t.m30*this.m03+t.m31*this.m13+t.m32*this.m23+t.m33*this.m33)}}const{sin:C,cos:M,acos:P,abs:L,sqrt:U}=Math;class F{static get identity(){return new F(1,0,0,0)}static get up(){return new F(.707,.707,0,0)}static get down(){return new F(.707,-.707,0,0)}static get left(){return new F(.707,0,.707,0)}static get right(){return new F(.707,0,-.707,0)}static get backward(){return new F(0,0,1,0)}static get upsideDown(){return new F(0,0,0,1)}static get tiltLeft(){return new F(.707,0,0,.707)}static get tiltRight(){return new F(.707,0,0,-.707)}static fromArray(t){return new F(...t)}static fromEulers(t,e,r){const s=M(.5*e),n=M(.5*r),i=M(.5*t),o=C(.5*e),a=C(.5*r),h=C(.5*t);return new F(s*n*i-o*a*h,s*n*h+o*a*i,o*n*i+s*a*h,s*a*i-o*n*h).normalize}static fromAxisAngle(t,e){const r=1/t.len,s=C(e/2);return new F(M(e/2),s*t.x*r,s*t.y*r,s*t.z*r).normalize}static fromRotation(t,e){const r=t.add(e),s=t.cross(r),n=t.dot(r);return new F(n,s.x,s.y,s.z).normalize}constructor(t,e,r,s){this.w=t||0,this.x=e||0,this.y=r||0,this.z=s||0}get clone(){return new F(this.w,this.x,this.y,this.z)}get toArray(){return[this.w,this.x,this.y,this.z]}get toMat3(){const{w:t,x:e,y:r,z:s}=this,n=e*t,i=e*e,o=e*r,a=e*s,h=r*t,u=r*r,c=r*s,m=s*t,l=s*s;return new E(1-2*(u+l),2*(o-m),2*(a+h),2*(o+m),1-2*(i+l),2*(c-n),2*(a-h),2*(c+n),1-2*(i+u))}get toMat4(){return this.toMat3.toMat4}get toEulers(){throw new Error("Quaternion toEuler not implemented")}get len(){return U(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)}get lenSqrt(){return this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z}get conjugate(){return new F(this.w,-this.x,-this.y,-this.z)}get normalize(){let t=U(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);return t>0?(t=1/t,new F(this.w*t,this.x*t,this.y*t,this.z*t)):new F(1,0,0,0)}get invert(){const t=1/this.len;return new F(this.w*t,-this.x*t,-this.y*t,-this.z*t)}mul(t){const e=this.w,r=this.x,s=this.y,n=this.z,i=t.w,o=t.x,a=t.y,h=t.z;return new F(e*i-r*o-s*a-n*h,r*i+e*o+s*h-n*a,s*i+e*a+n*o-r*h,n*i+e*h+r*a-s*o).normalize}scale(t){return new F(this.w*t,this.x*t,this.y*t,this.z*t)}dot(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z}cross(t){throw new Error(`Quaternion cross not implemented ${t}`)}lerp(t,e){const r=1-e;return new F(this.w*r+t.w*e,this.x*r+t.x*e,this.y*r+t.y*e,this.z*r+t.z*e)}nlerp(t,e){return this.lerp(t,e).normalize}slerp(t,e){if(e<=0)return this;if(e>=1)return t;let r=this.dot(t);if(L(r)>=1)return this;r<0&&(t=t.scale(-1),r=-r);const s=U(1-r*r);if(L(s)<.001)return new F(.5*(this.w+t.w),.5*(this.x+t.x),.5*(this.y+t.y),.5*(this.z+t.z)).normalize;const n=P(r),i=C((1-e)*n)/s,o=C(e*n)/s;return new F(this.w*i+t.w*o,this.x*i+t.x*o,this.y*i+t.y*o,this.z*i+t.z*o).normalize}}class B{constructor(t){this.node=t||null,this._targetTranslation=null,this._targetRotation=null,this._targetScale=null,this._origin=_.zero,this._rotateAroundOrigin=!1,this._localTranslation=_.zero,this._localScale=_.one,this._localRotation=F.identity,this._localTransformUnscaled=z.identity,this._localTransform=z.identity,this._worldTransformUnscaled=z.identity,this._worldTransform=z.identity,this._worldTransformDirty=!0}translateTo(t){this._targetTranslation=this._targetTranslation?this._targetTranslation.add(t):this._localTranslation.add(t)}rotateTo(t){this._targetRotation=this._targetRotation?this._targetRotation.mul(t):this._localRotation.mul(t)}get right(){const{m00:t,m01:e,m02:r}=this.worldTransform;return new _(t,e,r)}get up(){const{m10:t,m11:e,m12:r}=this.worldTransform;return new _(t,e,r)}get forward(){const{m20:t,m21:e,m22:r}=this.worldTransform;return new _(t,e,r)}set translation(t){this.setWorldTransformDirty(),this._localTranslation=new _(t.x,t.y,t.z)}set rotation(t){this.setWorldTransformDirty(),this._localRotation=new F(t.w,t.x,t.y,t.z)}set scale(t){this.setWorldTransformDirty(),this._localScale=new _(t.x,t.y,t.z)}set origin(t){this._rotateAroundOrigin=0!==t.lenSqrt,this._origin=t}get translation(){return this._targetTranslation||this._localTranslation}get rotation(){return this._localRotation}get scale(){return this._localScale}get origin(){return this._origin}get worldTransform(){return this._worldTransformDirty&&this.updateWorldTransform(),this._worldTransform.clone}get worldTransformUnscaled(){return this._worldTransformDirty&&this.updateWorldTransform(),this._worldTransformUnscaled.clone}translate(t){this.setWorldTransformDirty(),this._localTranslation=this._localTranslation.add(t)}rotate(t){this.setWorldTransformDirty(),this._localRotation=this._localRotation.mul(t)}setWorldTransformDirty(){this._worldTransformDirty||this.node.walkEnabled(t=>{t.transform._worldTransformDirty=!0})}updateLocalTransform(){const t=z.identity,e=this._localTranslation,r=this._localRotation.toMat3,s=this._localScale;if(t.m00=r.m00,t.m01=r.m01,t.m02=r.m02,t.m10=r.m10,t.m11=r.m11,t.m12=r.m12,t.m20=r.m20,t.m21=r.m21,t.m22=r.m22,this._rotateAroundOrigin){const{x:s,y:n,z:i}=this._origin;t.m30=s*r.m00+n*r.m10+i*r.m20+e.x,t.m31=s*r.m01+n*r.m11+i*r.m21+e.y,t.m32=s*r.m02+n*r.m12+i*r.m22+e.z}else t.m30=e.x,t.m31=e.y,t.m32=e.z;this._localTransformUnscaled=t.clone,t.m00*=s.x,t.m01*=s.x,t.m02*=s.x,t.m10*=s.y,t.m11*=s.y,t.m12*=s.y,t.m20*=s.z,t.m21*=s.z,t.m22*=s.z,this._localTransform=t}updateWorldTransform(){this.updateLocalTransform(),this.node.parent?(this._worldTransformUnscaled=this.node.parent.transform.worldTransformUnscaled.mul(this._localTransformUnscaled),this._worldTransform=this.node.parent.transform.worldTransformUnscaled.mul(this._localTransform)):(this._worldTransformUnscaled=this._localTransformUnscaled.clone,this._worldTransform=this._localTransform.clone),this._worldTransformDirty=!1}update(){let t=!1;this._targetTranslation&&(t=!0,this._localTranslation=this._localTranslation.lerp(this._targetTranslation,.1),this._targetTranslation.sub(this._localTranslation).lenSqrt<1e-6&&(this._localTranslation=this._targetTranslation,this._targetTranslation=null)),this._targetRotation&&(t=!0,this._localRotation=this._localRotation.nlerp(this._targetRotation,.1),this._targetRotation.dot(this._localRotation)>.999999&&(this._localRotation=this._targetRotation,this._targetRotation=null)),t&&this.setWorldTransformDirty()}}class k{constructor(t,e){this.scene=t||null,this.parent=e||null,this.transform=new B(this),this.children=[],this.components=[]}addChild(){const t=new k(this.scene,this);return this.children.push(t),t}removeChild(t){t.scene=null,t.parent=null,this.children.splice(this.children.indexOf(t),1)}addComponent(t){const e=new t(this);return this.components.push(e),e}removeComponent(t){t.node=null,this.components.splice(this.components.indexOf(t),1)}update(){this.transform.update();for(const t of this.children)t.update();for(const t of this.components)t.update()}remove(){const{children:t,components:e}=this;for(;t.length>0;)t[t.length-1].remove();for(;e.length>0;)e[e.length-1].remove();this.scene=null,this.parent=null,this.transform.node=null,this.transform=null,this.parent.removeChild(this)}walkEnabled(t){t(this);for(const e of this.children)e.walkEnabled(t)}}class D{constructor(t,e){this.node=t||null,this.type=e}update(){throw new Error(`No update method implemented for a component type ${this.type}`)}remove(){throw new Error(`No remove method implemented for a component type ${this.type}`)}}class O extends D{constructor(t){super(t,"Model"),this.mesh=null,this.materials=[]}addMesh(t){this.mesh=t}addMaterial(t){this.materials.push(t)}getGeometries(){return this.mesh&&this.mesh.geometries||null}getMaterials(){return this.materials.length&&this.materials||null}update(){}remove(){this.node.removeComponent(this),this.mesh=null,this.materials.length=0}}const{PI:N}=Math;class I extends D{constructor(t){var e,r,s;super(t,"Camera"),s=(({target:{innerWidth:t,innerHeight:e}})=>{const r=t/e;this._perspective=z.perspective(.25*N,r,.01,1e3),this._ortographic=z.orthographic(-r,r,-1,1,.01,1e3)}),(r="resize")in(e=this)?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,this.active=!0,this.inControl=!0;const n=window.innerWidth/window.innerHeight;this._perspective=z.perspective(.25*N,n,.01,1e3),this._ortographic=z.orthographic(-n,n,-1,1,.01,1e3),a.subscribe(this.resize)}get view(){return this.node.transform.worldTransform}get perspective(){return this._perspective.clone}get ortographic(){return this._ortographic.clone}update(){if(!this.inControl)return;const t=g.getKeys(),e=t.includes("d")?.1:t.includes("a")?-.1:0,r=t.includes("e")?.1:t.includes("q")?-.1:0,s=t.includes("s")?.1:t.includes("w")?-.1:0,{transform:n}=this.node;if(0!==e||0!==r||0!==s){const t=n.forward.scale(s).add(n.right.scale(e)).add(n.up.scale(r));n.translateTo(t)}const i=g.getMouse();if(g.getMouse1().press&&(0!==i.dx||0!==i.dy)){const t=F.fromAxisAngle(n.right,.005*-i.dy),e=F.fromAxisAngle(_.up,.005*i.dx);n.rotateTo(t.mul(e))}}remove(){this.node.removeComponent(this)}}const j=(t,e,r)=>{const i=e.addChild();for(const[e,{mesh:o,materials:a}]of Object.entries(t.components)){const t=n(e),h=s[t],u=i.addComponent(h);switch(t){case"Model":r.getResource(o,t=>{u.addMesh(t)});for(const t of a)r.getResource(t,t=>{u.addMaterial(t)})}}for(const[e,r]of Object.entries(t.transform))i.transform[e]=r;t.nodes.forEach(t=>{j(t,i,r)})};var $=class extends k{constructor(){super(),this.scene=this}buildFromResource(t,e){const{data:r}=t;r.nodes.forEach(t=>{j(t,this,e)})}remove(){const{children:t,components:e}=this;for(;t.length>0;)t[t.length-1].remove();for(;e.length>0;)e[e.length-1].remove();this.scene=null,this.parent=null,this.transform.node=null,this.transform=null}},q=r(5),X=r.n(q);class H{constructor(t){this.url=t}parse(){throw new Error(`No parse method defined for Resource type ${this.constructor.name}.`)}remove(){throw new Error(`No remove method defined for resource type ${this.constructor.name}.`)}}class W extends H{constructor(t){super(t),this.shaderSource=null,this.shaderProgram=null,this.textures=new Map,this.defines=new Map}parse(t){return"object"!=typeof t&&JSON.parse(t),e=>{e.getResource(t.shaderSource,t=>{this.shaderSource=t});for(const e of t.defines)this.enableDefine(e,null);for(const{define:r,src:s,value:n}of t.textures)e.getResource(s,t=>{this.addTexture(r,t)})}}addTexture(t,e){this.textures.set(t,e)}getTextures(){const t=[];for(const e of this.textures)t.push(e);return t.length?t:null}enableDefine(t,e){this.defines.set(t,e)}getDefines(){const t=[];for(const e of this.defines)t.push(e);return t.length?t:null}remove(){this.shaderSource=null,this.shaderProgram=null,this.textures.clear(),this.defines.clear()}}const V=t=>{const e=[];let r=0;return t.forEach(t=>{switch(t){case"a_position":e.push({name:"a_position",vertices:3,offset:r}),r+=12;break;case"a_texcoord":e.push({name:"a_texcoord",vertices:2,offset:r}),r+=8;break;case"a_normal":e.push({name:"a_normal",vertices:3,offset:r}),r+=12;break;case"a_tangent":e.push({name:"a_tangent",vertices:3,offset:r}),r+=12;break;case"a_bitangent":e.push({name:"a_bitangent",vertices:3,offset:r}),r+=12;break;default:throw new Error(`Unknown mesh attribute name: ${t}`)}}),e},Y=t=>{let e=0;return t.forEach(t=>{switch(t){case"a_position":e+=12;break;case"a_texcoord":e+=8;break;case"a_normal":case"a_tangent":case"a_bitangent":e+=12;break;default:throw new Error(`Unknown mesh attribute: ${t}`)}}),e},G=(t,e,r)=>{let s=0;const n=r?9:6,i=/[a-z_]+(?:\.\w+)?/i;i.test(e[0])&&e.splice(0,1),t.push(new y(0,null));for(let r=0;r<e.length;r+=n)i.test(e[r])?(e.splice(r,1),t[t.length-1].vertexCount=3*s,t.push(new y(3*r,null)),s=0,r-=1):s+=1;t[t.length-1].vertexCount=3*s},Q=(t,e,r,s)=>{if(e&&e.length>0)if(s){const s=e.length/2*3;for(let n=0;n<s;n+=9){const s=n/9;t.push(r[e[n+0]].getNormal(r[e[n+2]],r[e[n+4]])),e.splice(n+2,0,s),e.splice(n+5,0,s),e.splice(n+8,0,s)}}else{const s=2*e.length;for(let n=0;n<s;n+=6){const s=n/6;t.push(r[e[n+0]].getNormal(r[e[n+1]],r[e[n+2]])),e.splice(n+1,0,s),e.splice(n+3,0,s),e.splice(n+5,0,s)}}else{const e=r.length;for(let s=0;s<e;s+=3){const e=r[s+0].getNormal(r[s+1],r[s+2]);t.push(e,e,e)}}},K=(t,e,r,s,n)=>{const i=n.length/3*5;for(let o=0;o<i;o+=15){const i=r[n[o+0]],a=r[n[o+3]],h=r[n[o+6]],u=s[n[o+1]],c=s[n[o+4]],m=s[n[o+7]],l=a.x-i.x,d=h.x-i.x,f=a.y-i.y,p=h.y-i.y,g=a.z-i.z,w=h.z-i.z,y=c.x-u.x,x=m.x-u.x,v=c.y-u.y,b=m.y-u.y,T=1/(y*b-x*v),E=new _((b*l-v*d)*T,(b*f-v*p)*T,(b*g-v*w)*T).normalize,A=new _((y*d-x*l)*T,(y*p-x*f)*T,(y*w-x*g)*T).normalize;t.push(E),e.push(A);const R=o/15;n.splice(o+3,0,R,R),n.splice(o+8,0,R,R),n.splice(o+13,0,R,R)}},J=(t,e)=>{const r=lt.createBuffer();lt.bindBuffer(lt.ARRAY_BUFFER,r),lt.bufferData(lt.ARRAY_BUFFER,t,lt.STATIC_DRAW);const s=lt.createBuffer();return lt.bindBuffer(lt.ELEMENT_ARRAY_BUFFER,s),lt.bufferData(lt.ELEMENT_ARRAY_BUFFER,e,lt.STATIC_DRAW),{vertexBuffer:r,indiceBuffer:s}};var Z=class extends H{constructor(t){super(t),this.materialSources=[],this.geometries=[],this.attributes=[],this.vertexSize=null,this.vertexBuffer=null,this.indiceBuffer=null,this.vao=null}parse(t){const e=[],r=[],s=[],n=[],i=[],o=[],a=[],h=[],u=[],c=[],m=[],l=/^(\w+) (.+)$/gm,d=/-?\d+\.\d+/g,f=/\d+/g;let p="";if("object"==typeof t){const s=t.vertexData.length;for(let n=0;n<s;n+=2)e.push(t.vertexData[n+0]),r.push(t.vertexData[n+1]);o.push(...t.indices)}else{const n={v:t=>{e.push(new _(...t[2].match(d).map(parseFloat)))},vt:t=>{r.push(new v(...t[2].match(d).map(parseFloat)))},vn:t=>{s.push(new _(...t[2].match(d).map(parseFloat)).normalize)},f:t=>{o.push(...t[2].match(f).map(t=>parseInt(t,10)-1))},g:t=>{o.push(t[2]),a.push(t[2])},"#":t=>{},o:t=>{},usemtl:t=>{},s:t=>{},mtllib:t=>{}};for(;p=l.exec(t);)try{n[p[1]](p)}catch(t){throw new Error("Failed at parsing mesh file row.",p,t)}}e.length&&u.push("a_position");const g=!!r.length;if(g&&u.push("a_texcoord"),s.length||Q(s,o,e,g),u.push("a_normal"),G(h,o,g),h.forEach(t=>{t.mesh=this}),g&&(K(n,i,e,r,o),u.push("a_tangent","a_bitangent")),r){const t=o.length;for(let a=0;a<t;a+=5)c.push(...e[o[a+0]].toArray),c.push(...r[o[a+1]].toArray),c.push(...s[o[a+2]].toArray),c.push(...n[o[a+3]].toArray),c.push(...i[o[a+4]].toArray),m.push(a/5)}else{const t=o.length;for(let r=0;r<t;r+=2)c.push(...e[o[r+0]].toArray),c.push(...s[o[r+2]].toArray),m.push(r/2)}const w=J(new Float32Array(c),new Uint16Array(m));this.materialSources.push(...a.map(t=>t)),this.geometries=h,this.attributes=V(u),this.vertexSize=Y(u),this.vertexBuffer=w.vertexBuffer,this.indiceBuffer=w.indiceBuffer}remove(){this.geometries.forEach(t=>{t.mesh=null}),this.geometries.length=0,this.attributes.length=0,lt.deleteBuffer(this.vertexBuffer),lt.deleteBuffer(this.indiceBuffer),lt.deleteBuffer(this.vao),this.vertexBuffer=null,this.indiceBuffer=null,this.vao=null}};class tt extends H{constructor(t){super(t),this.data=null}parse(t){this.data=t}remove(){}}class et extends H{constructor(t){super(t),this.data=null}parse(t){this.data=t}createModifiedSource(t,e){let r="#version 300 es\n";if(!t)throw new Error(`Type of shader is invalid: ${t}`);return r+=t===lt.VERTEX_SHADER?"#define VERTEX\n":"#define FRAGMENT\n",`${r+=e.map(([t,e])=>`#define ${t}${e?`=${e}\n`:"\n"}`).join("")}#line 1\n${this.data}`}remove(){this.data=null}}const rt=t=>{const e=t.width,r=t.height,s=lt.createTexture();return lt.bindTexture(lt.TEXTURE_2D,s),lt.texImage2D(lt.TEXTURE_2D,0,lt.RGBA,e,r,0,lt.RGBA,lt.UNSIGNED_BYTE,t),e&e-1==0&&r&r-1==0?lt.generateMipmap(lt.TEXTURE_2D):(lt.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_S,lt.CLAMP_TO_EDGE),lt.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_T,lt.CLAMP_TO_EDGE),lt.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_MIN_FILTER,lt.LINEAR)),s};var st=class extends H{constructor(t){super(t),this.buffer=null}parse(t){const e=new Image;e.onload=(()=>{this.buffer=rt(e)}),e.src=`data:image/png;base64,${t}`}remove(){lt.deleteBuffer(this.buffer),this.buffer=null}};X.a.defaults.baseURL=`${window.location.origin}/api/glib`,X.a.defaults.headers.common.accept="image/png";const nt=/^\.(?:obj|mtl|png|jpg|cnf|glsl)$/,it=t=>{if(!t)return new Error("No url defined.");const e=t.lastIndexOf(".");if(-1===e)return new Error(`No file extension in url. Url: ${t}`);const r=t.slice(e);return(t=>nt.test(t))(r)?void 0:new Error(`Illegal file extension: ${r}`)},ot=t=>{switch(t.slice(t.lastIndexOf("."))){case".obj":return new Z(t);case".mtl":return new W(t);case".png":case".jpg":return new st(t);case".glsl":return new et(t);case".cnf":return new tt(t);default:throw new Error(`Unable to find resource with url: ${t}`)}};class at{static createShaderKey(t,e){return`${t}:${e.map(([t,e])=>`${t}=${e}`).join(",")}`}constructor(t,e,r){this.key=t,this.defines=r,this.shaderSource=e,this.program=null,this.attributeLocations={},this.uniformLocations={}}compileShaderProgram(){if(!this.shaderSource)throw new Error("No shadersource in shaderprogram");this.createProgram(this.createShader(lt.VERTEX_SHADER),this.createShader(lt.FRAGMENT_SHADER)),this.getAttributeLocations(),this.getUniformLocations()}createShader(t){const e=this.shaderSource.createModifiedSource(t,this.defines),r=lt.createShader(t);if(lt.shaderSource(r,e),lt.compileShader(r),!lt.getShaderParameter(r,lt.COMPILE_STATUS))throw new Error(`Error while creating shaderprogram: ${lt.getShaderInfoLog(r)}`);return r}createProgram(t,e){const r=lt.createProgram();if(lt.attachShader(r,t),lt.attachShader(r,e),lt.linkProgram(r),!lt.getProgramParameter(r,lt.LINK_STATUS))throw new Error(`Error while linking program: ${lt.getProgramInfoLog(r)}`);this.program=r}getAttributeLocations(){const t={},e=lt.getProgramParameter(this.program,lt.ACTIVE_ATTRIBUTES);for(let r=0;r<e;r+=1){const e=lt.getActiveAttrib(this.program,r).name;t[e]=lt.getAttribLocation(this.program,e)}this.attributeLocations=t}getUniformLocations(){const t={},e=lt.getProgramParameter(this.program,lt.ACTIVE_UNIFORMS);for(let r=0;r<e;r+=1){const e=lt.getActiveUniform(this.program,r).name;t[e]=lt.getUniformLocation(this.program,e)}this.uniformLocations=t}remove(){}}new Map;const ht=new $,ut=new class{constructor(){this.cache=new Map,this.loadQueue=new Map,this.loading=!1,this.onLoadDone=null}getResource(t,e){const r=it(t);if(r)throw new Error(r);if(this.cache.has(t)){const r=this.cache.get(t);return e&&e(r),r}if(this.loadQueue.has(t)){const r=this.loadQueue.get(t);return e&&(r.callbacks.push(e),this.loadQueue.set(t,r)),r.resource}{const r=ot(t),s=e?[e]:[];return this.loadQueue.set(r.url,{resource:r,callbacks:s}),this.loadNextResource(),r}}async loadNextResource(){if(this.loading)return;const t=this.loadQueue.values().next().value;if(!t)return void(this.onLoadDone&&this.onLoadDone());this.loading=!0;const{resource:e,callbacks:r}=t,s=await X.a.get(e.url);this.loadQueue.delete(e.url),this.cache.set(e.url,e);const n=e.parse(s.data);n&&n(this),r.forEach(t=>{t(e)}),this.loading=!1,this.loadNextResource()}deleteResource(t){t.remove(),this.cache.delete(t.url),this.loadQueue.delete(t.url)}deleteAllResources(){this.loading=!0,this.cache.forEach(t=>{t.delete()}),this.loadQueue.forEach(t=>{t.delete()}),this.cache.clear(),this.loadQueue.clear(),this.loading=!1}},ct=new class{constructor(t){t.getResource("def_colormap.default.png",t=>{this.defaultTexture=t}),t.getResource("def.default.mtl",t=>{this.defaultMaterial=t}),this.resourceManager=t,this.boundScene=null,this.boundCamera=null,this.boundShaderProgram=null,this.boundMesh=null,this.boundMaterial=null,this.shaderProgramCache=new Map}renderScene(t){const e=[];t.walkEnabled(t=>{t.components.forEach(t=>{switch(t.type){case"Model":this.queueRenderable(t,e);break;case"Camera":!this.boundCamera&&t.active&&(this.boundCamera=t)}})}),lt.clearColor(.4,.4,.4,1),lt.clear(lt.COLOR_BUFFER_BIT|lt.DEPTH_BUFFER_BIT),this.renderPass(t,e)}queueRenderable(t,e){if(!t.mesh)return;const r=t.getGeometries(),s=t.getMaterials();if(r&&s)for(let n=0;n<r.length;n+=1)this.queueGeometry(r[n],s[n],t.node.transform.worldTransform,e)}queueGeometry(t,e,r,s){for(const n of s)if(n.geometry===t&&n.material===e)return void n.worldTransforms.push(r);s.push(new w(t,e,r))}renderPass(t,e){lt.frontFace(lt.CCW),lt.enable(lt.CULL_FACE),lt.enable(lt.DITHER),lt.enable(lt.DEPTH_TEST),lt.depthMask(!0);for(const r of e){const{material:e,geometry:{mesh:s,vertexCount:n,vertexOffset:i}}=r;if(this.boundMaterial!==e){if(this.boundMaterial=e,this.bindShaderProgram(),!this.boundShaderProgram)continue;this.bindMesh(s),this.bindTextures(),this.bindScene(t),this.bindCamera()}this.drawIndividual(r,lt.TRIANGLES,n,lt.UNSIGNED_SHORT,i)}this.boundScene=null,this.boundCamera=null,this.boundShaderProgram=null,this.boundMesh=null,this.boundMaterial=null}bindShaderProgram(){const{boundMaterial:t}=this;if(t.shaderProgram)return this.boundShaderProgram=t.shaderProgram,void lt.useProgram(this.boundShaderProgram.program);let e=t.getDefines();if(e.length||(console.error(`Material ${t.src} is missing textures, added default colormap texture`),t.enableDefine("COLORMAP",1),t.addTexture("COLORMAP",this.defaultTexture),e=t.getDefines()),!t.shaderSource)return void(this.boundShaderProgram=null);const r=at.createShaderKey(t.shaderSource.url,e);let s=this.shaderProgramCache.get(r);s||((s=new at(r,t.shaderSource,e)).compileShaderProgram(),this.shaderProgramCache.set(s.key,s)),t.shaderProgram=s,this.boundShaderProgram=s,lt.useProgram(s.program)}bindMesh(t){if(this.boundMesh=t,t.vao)return void lt.bindVertexArray(t.vao);t.vao=lt.createVertexArray(),lt.bindVertexArray(t.vao),lt.bindBuffer(lt.ARRAY_BUFFER,t.vertexBuffer),lt.bindBuffer(lt.ELEMENT_ARRAY_BUFFER,t.indiceBuffer);const e=this.boundShaderProgram.attributeLocations,{attributes:r,vertexSize:s}=t;for(const{name:t,vertices:n,offset:i}of r)lt.enableVertexAttribArray(e[t]),lt.vertexAttribPointer(e[t],n,lt.FLOAT,!1,s,i)}bindTextures(){const t=this.boundShaderProgram.uniformLocations,e=this.boundMaterial.getTextures()||[["COLORMAP",this.defaultTexture]];let r=0;for(const[s,n]of e){let e;switch(s){case"COLORMAP":e=t.u_color_texture;break;case"NORMALMAP":e=t.u_normal_texture;break;case"SPECULARMAP":e=t.u_specular_texture;break;default:throw new Error(`No texture of type ${s} has been specified. Implement!`)}lt.activeTexture(lt.TEXTURE0+r),lt.bindTexture(lt.TEXTURE_2D,n.buffer),lt.uniform1i(e,r++)}}bindScene(t){const{u_time:e}=this.boundShaderProgram.uniformLocations;lt.uniform1f(e,performance.now())}bindCamera(){const{boundCamera:t}=this,{u_view:e,u_perspectice:r,u_view_inverted:s}=this.boundShaderProgram.uniformLocations;lt.uniformMatrix4fv(e,!1,t.view.toFloat32Array),lt.uniformMatrix4fv(r,!1,t.perspective.toFloat32Array),lt.uniformMatrix4fv(s,!1,t.view.invert.toFloat32Array)}drawIndividual(t,e,r,s,n){const{u_model:i,u_model_rotation:o,u_mvp:a,u_normal_matrix:h}=this.boundShaderProgram.uniformLocations,{view:u,perspective:c}=this.boundCamera;for(const m of t.worldTransforms)lt.uniformMatrix3fv(h,!1,m.toMat3.mul(u.toMat3).invert.transpose.toFloat32Array),lt.uniformMatrix3fv(o,!1,m.toMat3.invert.transpose.toFloat32Array),lt.uniformMatrix4fv(i,!1,m.toFloat32Array),lt.uniformMatrix4fv(a,!1,c.mul(u.invert).mul(m).toFloat32Array),lt.drawElements(e,r,s,2*n)}}(ut),mt=document.createElement("canvas"),lt=mt.getContext("webgl2");i("\n* {\n  font-family: 'Ubuntu', sans-serif;\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  font-size: 16px;\n}\n\nhtml body {\n  height: 100vh;\n  width: 100vw;\n  overflow: hidden;\n}\n\n#root {\n  width: 100%;\n  height: 100%;\n}\n\ncanvas {\n  width: 100%;\n  height: 100%;\n  background: gray;\n}\n"),new class{constructor({elementId:t,canvasId:e}){mt.id=e||"canvas",mt.width=window.innerWidth,mt.height=window.innerHeight,lt.viewport(0,0,lt.canvas.width,lt.canvas.height),a.subscribe(({target:{innerWidth:t,innerHeight:e}})=>{mt.width=t,mt.height=e,lt.viewport(0,0,t,e)}),document.getElementById(t||"root").appendChild(mt)}createScene(t){ut.getResource(t,t=>{ht.buildFromResource(t,ut);const e=()=>{requestAnimationFrame(e),ht.update(),g.update(),ct.renderScene(ht)};requestAnimationFrame(e),console.log(ht)})}}({elementId:"root",canvasId:"canvas"}).createScene("def.default.cnf");const dt=lt.createShader(lt.VERTEX_SHADER),ft=lt.createShader(lt.FRAGMENT_SHADER);lt.shaderSource(dt,"#version 300 es\nin vec3 a_pos;\nin vec3 a_col;\nuniform mat4 u_m;\nuniform mat4 u_v;\nuniform mat4 u_p;\nuniform mat4 u_mvp;\nout vec3 a_fragColor;\nvoid main () {\n  a_fragColor = a_col;\n  gl_Position = u_mvp * vec4(a_pos, 1.0);\n}"),lt.shaderSource(ft,"#version 300 es\nprecision mediump float;\nin vec3 a_pos;\nin vec3 a_fragColor;\nout vec4 fragColor;\nvoid main () {\n  fragColor = vec4(a_fragColor, 1.0);\n}"),lt.compileShader(dt),lt.compileShader(ft);const pt=lt.createProgram();lt.attachShader(pt,dt),lt.attachShader(pt,ft),lt.linkProgram(pt);const gt=lt.getAttribLocation(pt,"a_pos"),wt=lt.getAttribLocation(pt,"a_col"),yt=lt.getUniformLocation(pt,"u_mvp"),xt=lt.createBuffer();lt.bindBuffer(lt.ARRAY_BUFFER,xt),lt.bufferData(lt.ARRAY_BUFFER,new Float32Array([-.5,-.5,0,1,0,1,.5,-.5,0,0,1,0,0,.5,0,0,0,1,0,.5,0,0,1,0,.5,-.5,0,0,1,0,1,.5,0,0,1,0]),lt.STATIC_DRAW);const vt=lt.createBuffer();lt.bindBuffer(lt.ELEMENT_ARRAY_BUFFER,vt),lt.bufferData(lt.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,3,4,5]),lt.STATIC_DRAW),lt.bindBuffer(lt.ARRAY_BUFFER,xt),lt.bindBuffer(lt.ELEMENT_ARRAY_BUFFER,vt),lt.enableVertexAttribArray(gt),lt.enableVertexAttribArray(wt),lt.vertexAttribPointer(gt,3,lt.FLOAT,!1,24,0),lt.vertexAttribPointer(wt,3,lt.FLOAT,!1,24,12),lt.clearColor(0,0,0,0),lt.clear(lt.COLOR_BUFFER_BIT),lt.useProgram(pt);const bt=z.translate(0,0,-5).mul(z.rotateY(1)),_t=z.identity.invert,Tt=z.perspective(.25*Math.PI,window.innerWidth/window.innerHeight,.01,1e3).mul(_t).mul(bt);lt.uniformMatrix4fv(yt,!1,Tt.toFloat32Array),lt.drawArrays(lt.TRIANGLES,0,6)}]);