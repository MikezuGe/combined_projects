!function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=13)}([function(t,e,r){"use strict";var n=r(8),s=r(38),i=Object.prototype.toString;function o(t){return"[object Array]"===i.call(t)}function a(t){return null!==t&&"object"==typeof t}function u(t){return"[object Function]"===i.call(t)}function c(t,e){if(null!==t&&void 0!==t)if("object"!=typeof t&&(t=[t]),o(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(null,t[s],s,t)}t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===i.call(t)},isBuffer:s,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===i.call(t)},isFile:function(t){return"[object File]"===i.call(t)},isBlob:function(t){return"[object Blob]"===i.call(t)},isFunction:u,isStream:function(t){return a(t)&&u(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:c,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,s=arguments.length;n<s;n++)c(arguments[n],r);return e},extend:function(t,e,r){return c(e,function(e,s){t[s]=r&&"function"==typeof e?n(e,r):e}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(23);Object.defineProperty(e,"Color",{enumerable:!0,get:function(){return l(n).default}});var s=r(24);Object.defineProperty(e,"Vec2",{enumerable:!0,get:function(){return l(s).default}});var i=r(25);Object.defineProperty(e,"Vec3",{enumerable:!0,get:function(){return l(i).default}});var o=r(26);Object.defineProperty(e,"Mat3",{enumerable:!0,get:function(){return l(o).default}});var a=r(27);Object.defineProperty(e,"Mat4",{enumerable:!0,get:function(){return l(a).default}});var u=r(28);Object.defineProperty(e,"Quat",{enumerable:!0,get:function(){return l(u).default}});var c=r(29);function l(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Easing",{enumerable:!0,get:function(){return l(c).default}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gl=void 0;var n=o(r(19)),s=o(r(35)),i=o(r(62));function o(t){return t&&t.__esModule?t:{default:t}}const a=new n.default,u=new s.default,c=new i.default(u),l=document.createElement("canvas"),h=l.getContext("webgl2");e.default=class{constructor({elementId:t,canvasId:e,width:r,height:n}){l.id=e||"canvas",l.width=r||window.innerWidth,l.height=n||window.innerHeight,h.viewport(0,0,h.canvas.width,h.canvas.height),document.getElementById(t||"root").appendChild(l)}createScene(t){u.getResource(t,t=>{a.buildFromResource(t,u);const e=()=>{requestAnimationFrame(e),a.update(),c.renderScene(a)};requestAnimationFrame(e),console.log(a)})}},e.gl=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.url=t}parse(){throw new Error(`No parse method defined for Resource type ${this.constructor.name}.`)}remove(){throw new Error(`No remove method defined for resource type ${this.constructor.name}.`)}}},function(t,e,r){"use strict";(function(e){var n=r(0),s=r(41),i={"Content-Type":"application/x-www-form-urlencoded"};function o(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var a={adapter:function(){var t;return"undefined"!=typeof XMLHttpRequest?t=r(9):void 0!==e&&(t=r(9)),t}(),transformRequest:[function(t,e){return s(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(o(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(o(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],function(t){a.headers[t]={}}),n.forEach(["post","put","patch"],function(t){a.headers[t]=n.merge(i)}),t.exports=a}).call(this,r(40))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(21);Object.defineProperty(e,"GeometryBatch",{enumerable:!0,get:function(){return n.GeometryBatch}}),Object.defineProperty(e,"LightBatch",{enumerable:!0,get:function(){return n.LightBatch}});var s=r(6);Object.defineProperty(e,"Geometry",{enumerable:!0,get:function(){return o(s).default}});var i=r(22);function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return o(i).default}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.mesh=null,this.vertexOffset=t,this.vertexCount=e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.node=t||null,this.type=e}update(){throw new Error(`No update method implemented for a component type ${this.type}`)}remove(){throw new Error(`No remove method implemented for a component type ${this.type}`)}}},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";var n=r(0),s=r(42),i=r(44),o=r(45),a=r(46),u=r(10),c="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||r(47);t.exports=function(t){return new Promise(function(e,l){var h=t.data,m=t.headers;n.isFormData(h)&&delete m["Content-Type"];var f=new XMLHttpRequest,d="onreadystatechange",p=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||a(t.url)||(f=new window.XDomainRequest,d="onload",p=!0,f.onprogress=function(){},f.ontimeout=function(){}),t.auth){var g=t.auth.username||"",w=t.auth.password||"";m.Authorization="Basic "+c(g+":"+w)}if(f.open(t.method.toUpperCase(),i(t.url,t.params,t.paramsSerializer),!0),f.timeout=t.timeout,f[d]=function(){if(f&&(4===f.readyState||p)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in f?o(f.getAllResponseHeaders()):null,n={data:t.responseType&&"text"!==t.responseType?f.response:f.responseText,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:r,config:t,request:f};s(e,l,n),f=null}},f.onerror=function(){l(u("Network Error",t,null,f)),f=null},f.ontimeout=function(){l(u("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",f)),f=null},n.isStandardBrowserEnv()){var y=r(48),v=(t.withCredentials||a(t.url))&&t.xsrfCookieName?y.read(t.xsrfCookieName):void 0;v&&(m[t.xsrfHeaderName]=v)}if("setRequestHeader"in f&&n.forEach(m,function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete m[e]:f.setRequestHeader(e,t)}),t.withCredentials&&(f.withCredentials=!0),t.responseType)try{f.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&f.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){f&&(f.abort(),l(t),f=null)}),void 0===h&&(h=null),f.send(h)})}},function(t,e,r){"use strict";var n=r(43);t.exports=function(t,e,r,s,i){var o=new Error(t);return n(o,e,r,s,i)}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){"use strict";r(14);var n=r(2),s=function(t){return t&&t.__esModule?t:{default:t}}(n),i=r(1);new s.default({elementId:"root",canvasId:"canvas"}).createScene("def.default.cnf");const o=n.gl.createShader(n.gl.VERTEX_SHADER),a=n.gl.createShader(n.gl.FRAGMENT_SHADER);n.gl.shaderSource(o,"#version 300 es\nin vec3 a_pos;\nin vec3 a_col;\nuniform mat4 u_m;\nuniform mat4 u_v;\nuniform mat4 u_p;\nuniform mat4 u_mvp;\nout vec3 a_fragColor;\nvoid main () {\n  a_fragColor = a_col;\n  gl_Position = u_mvp * vec4(a_pos, 1.0);\n}"),n.gl.shaderSource(a,"#version 300 es\nprecision mediump float;\nin vec3 a_pos;\nin vec3 a_fragColor;\nout vec4 fragColor;\nvoid main () {\n  fragColor = vec4(a_fragColor, 1.0);\n}"),n.gl.compileShader(o),n.gl.compileShader(a);const u=n.gl.createProgram();n.gl.attachShader(u,o),n.gl.attachShader(u,a),n.gl.linkProgram(u);const c=n.gl.getAttribLocation(u,"a_pos"),l=n.gl.getAttribLocation(u,"a_col"),h=n.gl.getUniformLocation(u,"u_mvp"),m=n.gl.createBuffer();n.gl.bindBuffer(n.gl.ARRAY_BUFFER,m),n.gl.bufferData(n.gl.ARRAY_BUFFER,new Float32Array([-.5,-.5,0,1,0,1,.5,-.5,0,0,1,0,0,.5,0,0,0,1,0,.5,0,0,1,0,.5,-.5,0,0,1,0,1,.5,0,0,1,0]),n.gl.STATIC_DRAW);const f=n.gl.createBuffer();n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,f),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,3,4,5]),n.gl.STATIC_DRAW),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,m),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,f),n.gl.enableVertexAttribArray(c),n.gl.enableVertexAttribArray(l),n.gl.vertexAttribPointer(c,3,n.gl.FLOAT,!1,24,0),n.gl.vertexAttribPointer(l,3,n.gl.FLOAT,!1,24,12),n.gl.clearColor(0,0,0,0),n.gl.clear(n.gl.COLOR_BUFFER_BIT),n.gl.useProgram(u);const d=i.Mat4.translate(0,0,-5).mul(i.Mat4.rotateY(1)),p=i.Mat4.identity.invert,g=i.Mat4.perspective(.25*Math.PI,window.innerWidth/window.innerHeight,.01,1e3).mul(p).mul(d);n.gl.uniformMatrix4fv(h,!1,g.toFloat32Array),n.gl.drawArrays(n.gl.TRIANGLES,0,6)},function(t,e,r){var n=r(15);"string"==typeof n&&(n=[[t.i,n,""]]);var s={singleton:!0,sourceMap:!1,convertToAbsoluteUrls:!0,hmr:!0,transform:void 0,insertInto:void 0};r(17)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,r){(t.exports=r(16)(!1)).push([t.i,"\r\n* {\r\n  font-family: 'Ubuntu', sans-serif;\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n  font-size: 16px;\r\n}\r\n\r\nhtml body {\r\n  height: 100vh;\r\n  width: 100vw;\r\n  overflow: hidden;\r\n}\r\n\r\n#root {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\ncanvas {\r\n  background: gray;\r\n}\r\n",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var s=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(n),i=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[r].concat(i).concat([s]).join("\n")}return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var i=this[s][0];"number"==typeof i&&(n[i]=!0)}for(s=0;s<t.length;s++){var o=t[s];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),e.push(o))}},e}},function(t,e,r){var n={},s=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),i=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var r=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}}(),o=null,a=0,u=[],c=r(18);function l(t,e){for(var r=0;r<t.length;r++){var s=t[r],i=n[s.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](s.parts[o]);for(;o<s.parts.length;o++)i.parts.push(g(s.parts[o],e))}else{var a=[];for(o=0;o<s.parts.length;o++)a.push(g(s.parts[o],e));n[s.id]={id:s.id,refs:1,parts:a}}}}function h(t,e){for(var r=[],n={},s=0;s<t.length;s++){var i=t[s],o=e.base?i[0]+e.base:i[0],a={css:i[1],media:i[2],sourceMap:i[3]};n[o]?n[o].parts.push(a):r.push(n[o]={id:o,parts:[a]})}return r}function m(t,e){var r=i(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=u[u.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),u.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=i(t.insertInto+" "+t.insertAt.before);r.insertBefore(e,s)}}function f(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function d(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),p(e,t.attrs),m(t,e),e}function p(t,e){Object.keys(e).forEach(function(r){t.setAttribute(r,e[r])})}function g(t,e){var r,n,s,i;if(e.transform&&t.css){if(!(i=e.transform(t.css)))return function(){};t.css=i}if(e.singleton){var u=a++;r=o||(o=d(e)),n=y.bind(null,r,u,!1),s=y.bind(null,r,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",p(e,t.attrs),m(t,e),e}(e),n=function(t,e,r){var n=r.css,s=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||i)&&(n=c(n));s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var o=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}.bind(null,r,e),s=function(){f(r),r.href&&URL.revokeObjectURL(r.href)}):(r=d(e),n=function(t,e){var r=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}.bind(null,r),s=function(){f(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=h(t,e);return l(r,e),function(t){for(var s=[],i=0;i<r.length;i++){var o=r[i];(a=n[o.id]).refs--,s.push(a)}t&&l(h(t,e),e);for(i=0;i<s.length;i++){var a;if(0===(a=s[i]).refs){for(var u=0;u<a.parts.length;u++)a.parts[u]();delete n[a.id]}}}};var w=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}();function y(t,e,r,n){var s=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=w(e,s);else{var i=document.createTextNode(s),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s,i=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(s=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(20)),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(30)),i=r(33);const o=(t,e,r)=>{const n=e.addChild();for(const[e,{mesh:o,materials:a}]of Object.entries(t.components)){const t=(0,i.firstLetterToUpper)(e),u=s[t],c=n.addComponent(u);switch(t){case"Model":r.getResource(o,t=>{c.addMesh(t)});for(const t of a)r.getResource(t,t=>{c.addMaterial(t)})}}for(const[e,r]of Object.entries(t.transform))n.transform[e]=r;t.nodes.forEach(t=>{o(t,n,r)})};e.default=class extends n.default{constructor(){super(),this.scene=this}buildFromResource(t,e){const{data:r}=t;r.nodes.forEach(t=>{o(t,this,e)})}remove(){const{children:t,components:e}=this;for(;t.length>0;)t[t.length-1].remove();for(;e.length>0;)e[e.length-1].remove();this.scene=null,this.parent=null,this.transform.node=null,this.transform=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(5);class s{constructor(t,e){this.scene=t||null,this.parent=e||null,this.transform=new n.Transform(this),this.children=[],this.components=[]}addChild(){const t=new s(this.scene,this);return this.children.push(t),t}removeChild(t){t.scene=null,t.parent=null,this.children.splice(this.children.indexOf(t),1)}addComponent(t){const e=new t(this);return this.components.push(e),e}removeComponent(t){t.node=null,this.components.splice(this.components.indexOf(t),1)}update(){for(const t of this.children)t.update();for(const t of this.components)t.update()}remove(){const{children:t,components:e}=this;for(;t.length>0;)t[t.length-1].remove();for(;e.length>0;)e[e.length-1].remove();this.scene=null,this.parent=null,this.transform.node=null,this.transform=null,this.parent.removeChild(this)}walkEnabled(t){t(this);for(const e of this.children)e.walkEnabled(t)}}e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.GeometryBatch=class{constructor(t,e,r){this.geometry=t||null,this.material=e||null,this.worldTransforms=[r]}};e.LightBatch=class{constructor(t,e,r,n,s,i,o){this.type=t||null,this.color=[e],this.range=[r],this.diffuseStrength=[n],this.specularStrength=[s],this.shininess=[i],this.worldTransforms=[o]}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);e.default=class{constructor(t){this.node=t||null,this._startTranslation=null,this._targetTranslation=null,this._startRotation=null,this._targetRotation=null,this._startScale=null,this._targetScale=null,this._origin=n.Vec3.zero,this._rotateAroundOrigin=!1,this._localTranslation=n.Vec3.zero,this._localScale=n.Vec3.one,this._localRotation=n.Quat.identity,this._localTransformUnscaled=n.Mat4.identity,this._localTransform=n.Mat4.identity,this._worldTransformUnscaled=n.Mat4.identity,this._worldTransform=n.Mat4.identity,this._worldTransformDirty=!0}get right(){const{m00:t,m10:e,m20:r}=this.worldTransform;return new n.Vec3(t,e,r)}get up(){const{m01:t,m11:e,m21:r}=this.worldTransform;return new n.Vec3(t,e,r)}get forward(){const{m02:t,m12:e,m22:r}=this.worldTransform;return new n.Vec3(t,e,r)}set translation(t){this.setWorldTransformDirty(),this._localTranslation=new n.Vec3(t.x,t.y,t.z)}set rotation(t){this.setWorldTransformDirty(),this._localRotation=n.Quat.fromEulers(t.x,t.y,t.z)}set scale(t){this.setWorldTransformDirty(),this._localScale=new n.Vec3(t.x,t.y,t.z)}set origin(t){this._rotateAroundOrigin=0!==t.lenSqrt,this._origin=t}get translation(){return this._localTranslation}get rotation(){return this._localRotation}get scale(){return this._localScale}get origin(){return this._origin}get worldTransform(){return this._worldTransformDirty&&this.updateWorldTransform(),this._worldTransform.clone}get worldTransformUnscaled(){return this._worldTransformDirty&&this.updateWorldTransform(),this._worldTransformUnscaled.clone}translate(t){this.setWorldTransformDirty(),this._localTranslation=this._localTranslation.add(t)}rotate(t){this.setWorldTransformDirty(),this._localRotation=this._localRotation.mul(t)}setWorldTransformDirty(){this._worldTransformDirty||this.node.walkEnabled(t=>{t.transform._worldTransformDirty=!0})}updateLocalTransform(){const t=n.Mat4.identity,e=this._localTranslation,r=this._localRotation.toMat3,s=this._localScale;if(t.m00=r.m00,t.m01=r.m01,t.m02=r.m02,t.m10=r.m10,t.m11=r.m11,t.m12=r.m12,t.m20=r.m20,t.m21=r.m21,t.m22=r.m22,this._rotateAroundOrigin){const{x:n,y:s,z:i}=this._origin;t.m30=n*r.m00+s*r.m10+i*r.m20+e.x,t.m31=n*r.m01+s*r.m11+i*r.m21+e.y,t.m32=n*r.m02+s*r.m12+i*r.m22+e.z}else t.m30=e.x,t.m31=e.y,t.m32=e.z;this._localTransformUnscaled=t.clone,t.m00*=s.x,t.m01*=s.x,t.m02*=s.x,t.m10*=s.y,t.m11*=s.y,t.m12*=s.y,t.m20*=s.z,t.m21*=s.z,t.m22*=s.z,this._localTransform=t}updateWorldTransform(){this.updateLocalTransform(),this.node.parent?(this._worldTransformUnscaled=this.node.parent.transform.worldTransformUnscaled.mul(this._localTransformUnscaled),this._worldTransform=this.node.parent.transform.worldTransformUnscaled.mul(this._localTransform)):(this._worldTransformUnscaled=this._localTransformUnscaled.clone,this._worldTransform=this._localTransform.clone),this._worldTransformDirty=!1}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{static get white(){return new n(1,1,1)}static get red(){return new n(1,0,0)}static get green(){return new n(0,1,0)}static get blue(){return new n(0,0,1)}static get black(){return new n(0,0,0)}static fromArray(t){return new n(...t)}static fromHex(t){return new n(...[t.slice(2,4),t.slice(4,6),t.slice(6,8)].map(t=>parseInt(t,16)/255))}constructor(t,e,r){this.r=t||0,this.g=e||0,this.b=r||0}get copy(){return new n(this.r,this.g,this.b)}get toArray(){return[this.r,this.g,this.b]}get toHex(){return`0x${[(255*this.r).toString(16),(255*this.g).toString(16),(255*this.b).toString(16)].map(t=>t.length<2?`'0'${t}`:t).join("")}`}}e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const{sqrt:n}=Math;class s{static get zero(){return new s(0,0)}static get up(){return new s(0,1)}static get down(){return new s(0,-1)}static get left(){return new s(-1,0)}static get right(){return new s(1,0)}static fromArray(t){return new s(...t)}constructor(t,e){this.x=t||0,this.y=e||0}get toArray(){return[this.x,this.y]}get toFloat32Array(){return new Float32Array([this.x,this.y])}get clone(){return new s(this.x,this.y)}get len(){return n(this.x*this.x+this.y*this.y)}get lenSqrt(){return this.x*this.x+this.y*this.y}get normalize(){let t=n(this.x*this.x+this.y*this.y);return t>0?(t=1/t,new s(this.x*t,this.y*t)):new s(0,0)}add(t){return new s(this.x+t.x,this.y+t.y)}sub(t){return new s(this.x-t.x,this.y-t.y)}scale(t){return new s(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}getAngle(t){return this.normalize.dot(t.normalize)}invert(){return new s(-this.x,-this.y)}}e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const{sqrt:n}=Math;class s{static get zero(){return new s(0,0,0)}static get up(){return new s(0,1,0)}static get down(){return new s(0,-1,0)}static get left(){return new s(-1,0,0)}static get right(){return new s(1,0,0)}static get forward(){return new s(0,0,1)}static get backward(){return new s(0,0,-1)}static get one(){return new s(1,1,1)}static fromArray(t){return new s(...t)}static fromQuat(t){const e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,u=t.w,c=u*e+o*n-a*r,l=u*r+a*e-i*n,h=u*n+i*r-o*e,m=-i*e-o*r-a*n;return new s(c*u+m*-i+l*-a-h*-o,l*u+m*-o+h*-i-c*-a,h*u+m*-a+c*-o-l*-i)}static fromMat4(t){return new s(t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z)}constructor(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}get forward(){return this.normalize}get backward(){return this.normalize.invert}get left(){return this.normalize.cross(s.up).normalize}get right(){return this.normalize.cross(s.up).normalize.invert}get down(){return this.normalize.cross(this.left).normalize}get up(){return this.normalize.cross(this.left).normalize.invert}get toArray(){return[this.x,this.y,this.z]}get toFloat32Array(){return new Float32Array([this.x,this.y,this.z])}get clone(){return new s(this.x,this.y,this.z)}get len(){return n(this.x*this.x+this.y*this.y+this.z*this.z)}get lenSqrt(){return this.x*this.x+this.y*this.y+this.z*this.z}get normalize(){let t=n(this.x*this.x+this.y*this.y+this.z*this.z);return t>0?(t=1/t,new s(this.x*t,this.y*t,this.z*t)):new s(0,0,0)}get invert(){return new s(-this.x,-this.y,-this.z)}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}scale(t){return new s(this.x*t,this.y*t,this.z*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}lerp(t,e){return new s(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e,this.z+(t.z-this.z)*e)}getNormal(t,e){return this.sub(t).cross(this.sub(e)).normalize}getAngle(t){return this.normalize.dot(t.normalize)}}e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);const{sqrt:s}=Math;class i{static get identity(){return new i(1,0,0,0,1,0,0,0,1)}static fromArray(t){return new i(...t)}constructor(t,e,r,n,s,i,o,a,u){this.m00=t,this.m01=e,this.m02=r,this.m10=n,this.m11=s,this.m12=i,this.m20=o,this.m21=a,this.m22=u}get clone(){return new i(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}get toArray(){return[this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22]}get toFloat32Array(){return new Float32Array([this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22])}get toMat4(){return new n.Mat4(this.m00,this.m01,this.m02,0,this.m10,this.m11,this.m12,0,this.m20,this.m21,this.m22,0,0,0,0,1)}get toQuat(){const t=this.m00+this.m11+this.m22;let e;return t>0?(e=.5/s(t+1),new n.Quat(.25/e,(this.m21-this.m12)*e,(this.m02-this.m20)*e)):this.m00>this.m11&&this.m00>this.m22?(e=2*s(1+this.m00-this.m11-this.m22),new n.Quat((this.m21-this.m12)/e,.25*e,(this.m01+this.m10)/e,(this.m02+this.m20)/e)):this.m11>this.m22?(e=2*s(1+this.m11-this.m00-this.m22),new n.Quat((this.m02-this.m20)/e,(this.m01+this.m10)/e,.25*e,(this.m12+this.m21)/e)):(e=2*s(1+this.m22-this.m00-this.m11),new n.Quat((this.m10-this.m01)/e,(this.m02+this.m20)/e,(this.m12+this.m21)/e))}get invert(){const{m00:t,m01:e,m02:r,m10:n,m11:s,m12:o,m20:a,m21:u,m22:c}=this,l=c*s-o*u,h=-c*n+o*a,m=u*n-s*a;let f=t*l+e*h+r*m;if(0===f)throw new Error(`Cannot invert matrix ${this}`);return new i(l*(f=1/f),(-c*e+r*u)*f,(o*e-r*s)*f,h*f,(c*t-r*a)*f,(-o*t+r*n)*f,m*f,(-u*t+e*a)*f,(s*t-e*n)*f)}get transpose(){return new i(this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22)}multiplyVector(t){return new i(this.m00*t.x+this.m01*t.y+this.m02*t.z,this.m10*t.x+this.m11*t.y+this.m12*t.z,this.m20*t.x+this.m21*t.y+this.m22*t.z)}add(t){return new i(this.m00+t.m00,this.m01+t.m01,this.m02+t.m02,this.m10+t.m10,this.m11+t.m11,this.m12+t.m12,this.m20+t.m20,this.m21+t.m21,this.m22+t.m22)}sub(t){return new i(this.m00-t.m00,this.m01-t.m01,this.m02-t.m02,this.m10-t.m10,this.m11-t.m11,this.m12-t.m12,this.m20-t.m20,this.m21-t.m21,this.m22-t.m22)}mul(t){const e=this.m00,r=this.m01,n=this.m02,s=this.m10,o=this.m11,a=this.m12,u=this.m20,c=this.m21,l=this.m22,h=t.m00,m=t.m01,f=t.m02,d=t.m10,p=t.m11,g=t.m12,w=t.m20,y=t.m21,v=t.m22;return new i(e*h+r*d+n*w,e*m+r*p+n*y,e*f+r*g+n*v,s*h+o*d+a*w,s*m+o*p+a*y,s*f+o*g+a*v,u*h+c*d+l*w,u*m+c*p+l*y,u*f+c*g+l*v)}}e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);const{sin:s,cos:i,tan:o}=Math;class a{static get identity(){return new a(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static fromArray(t){return new a(...t)}static perspective(t,e,r,n){const s=1/o(t/2),i=1/(r-n);return new a(s/e,0,0,0,0,s,0,0,0,0,(r+n)*i,-1,0,0,r*n*i*2,0)}static orthographic(t,e,r,n,s,i){const o=1/(t-e),u=1/(r-n),c=1/(s-i);return new a(2*o,0,0,0,0,2*u,0,0,0,0,2*c,0,(t+e)*o,(n+r)*u,(i+s)*c,1)}static translate(t,e,r){return new a(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1)}static rotateX(t){const e=i(t),r=s(t);return new a(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1)}static rotateY(t){const e=i(t),r=s(t);return new a(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1)}static rotateZ(t){const e=i(t),r=s(t);return new a(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1)}static scale(t,e,r){return new a(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)}constructor(t,e,r,n,s,i,o,a,u,c,l,h,m,f,d,p){this.m00=t||0,this.m01=e||0,this.m02=r||0,this.m03=n||0,this.m10=s||0,this.m11=i||0,this.m12=o||0,this.m13=a||0,this.m20=u||0,this.m21=c||0,this.m22=l||0,this.m23=h||0,this.m30=m||0,this.m31=f||0,this.m32=d||0,this.m33=p||0}get clone(){return new a(this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33)}get toArray(){return[this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33]}get toFloat32Array(){return new Float32Array([this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33])}get toMat3(){return new n.Mat3(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}get toQuat(){return this.toMat3.toQuat}get invert(){const{m00:t,m01:e,m02:r,m03:n,m10:s,m11:i,m12:o,m13:u,m20:c,m21:l,m22:h,m23:m,m30:f,m31:d,m32:p,m33:g}=this,w=i*h*g-i*m*p-l*o*g+l*u*p+d*o*m-d*u*h,y=-s*h*g+s*m*p+c*o*g-c*u*p-f*o*m+f*u*h,v=s*l*g-s*m*d-c*i*g+c*u*d+f*i*m-f*u*l,b=-s*l*p+s*h*d+c*i*p-c*o*d-f*i*h+f*o*l;let x=t*w+e*y+r*v+n*b;if(0===x)throw new Error(`Cannot invert matrix ${this}`);return new a((x=1/x)*w,x*-e*h*g+e*m*p+l*r*g-l*n*p-d*r*m+d*n*h,x*e*o*g-e*u*p-i*r*g+i*n*p+d*r*u-d*n*o,x*-e*o*m+e*u*h+i*r*m-i*n*h-l*r*u+l*n*o,x*y,x*t*h*g-t*m*p-c*r*g+c*n*p+f*r*m-f*n*h,x*-t*o*g+t*u*p+s*r*g-s*n*p-f*r*u+f*n*o,x*t*o*m-t*u*h-s*r*m+s*n*h+c*r*u-c*n*o,x*v,x*-t*l*g+t*m*d+c*e*g-c*n*d-f*e*m+f*n*l,x*t*i*g-t*u*d-s*e*g+s*n*d+f*e*u-f*n*i,x*-t*i*m+t*u*l+s*e*m-s*n*l-c*e*u+c*n*i,x*b,x*t*l*p-t*h*d-c*e*p+c*r*d+f*e*h-f*r*l,x*-t*i*p+t*o*d+s*e*p-s*r*d-f*e*o+f*r*i,x*t*i*h-t*o*l-s*e*h+s*r*l+c*e*o-c*r*i)}get transpose(){return new a(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33)}get translation(){return new n.Vec3(this.m30,this.m31,this.m32)}get scale(){return new n.Vec3(new n.Vec3(this.m00,this.m10,this.m20).len,new n.Vec3(this.m01,this.m11,this.m21).len,new n.Vec3(this.m02,this.m12,this.m22).len)}get rotation(){return new n.Mat3(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)}lookAt(t,e){const r=this.sub(t).normalize,n=e.cross(r),s=r.cross(n);return new a(n.x,n.y,n.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,0,this.x,this.y,this.z,1)}add(t){return new a(this.m00+t.m00,this.m01+t.m01,this.m02+t.m02,this.m03+t.m03,this.m10+t.m10,this.m11+t.m11,this.m12+t.m12,this.m13+t.m13,this.m20+t.m20,this.m21+t.m21,this.m22+t.m22,this.m23+t.m23,this.m30+t.m30,this.m31+t.m31,this.m32+t.m32,this.m33+t.m33)}sub(t){return new a(this.m00-t.m00,this.m01-t.m01,this.m02-t.m02,this.m03-t.m03,this.m10-t.m10,this.m11-t.m11,this.m12-t.m12,this.m13-t.m13,this.m20-t.m20,this.m21-t.m21,this.m22-t.m22,this.m23-t.m23,this.m30-t.m30,this.m31-t.m31,this.m32-t.m32,this.m33-t.m33)}mul(t){return new a(t.m00*this.m00+t.m01*this.m10+t.m02*this.m20+t.m03*this.m30,t.m00*this.m01+t.m01*this.m11+t.m02*this.m21+t.m03*this.m31,t.m00*this.m02+t.m01*this.m12+t.m02*this.m22+t.m03*this.m32,t.m00*this.m03+t.m01*this.m13+t.m02*this.m23+t.m03*this.m33,t.m10*this.m00+t.m11*this.m10+t.m12*this.m20+t.m13*this.m30,t.m10*this.m01+t.m11*this.m11+t.m12*this.m21+t.m13*this.m31,t.m10*this.m02+t.m11*this.m12+t.m12*this.m22+t.m13*this.m32,t.m10*this.m03+t.m11*this.m13+t.m12*this.m23+t.m13*this.m33,t.m20*this.m00+t.m21*this.m10+t.m22*this.m20+t.m23*this.m30,t.m20*this.m01+t.m21*this.m11+t.m22*this.m21+t.m23*this.m31,t.m20*this.m02+t.m21*this.m12+t.m22*this.m22+t.m23*this.m32,t.m20*this.m03+t.m21*this.m13+t.m22*this.m23+t.m23*this.m33,t.m30*this.m00+t.m31*this.m10+t.m32*this.m20+t.m33*this.m30,t.m30*this.m01+t.m31*this.m11+t.m32*this.m21+t.m33*this.m31,t.m30*this.m02+t.m31*this.m12+t.m32*this.m22+t.m33*this.m32,t.m30*this.m03+t.m31*this.m13+t.m32*this.m23+t.m33*this.m33)}}e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);const{sin:s,cos:i,acos:o,abs:a,sqrt:u}=Math;class c{static get identity(){return new c(1,0,0,0)}static get up(){return new c(.707,.707,0,0)}static get down(){return new c(.707,-.707,0,0)}static get left(){return new c(.707,0,.707,0)}static get right(){return new c(.707,0,-.707,0)}static get backward(){return new c(0,0,1,0)}static get upsideDown(){return new c(0,0,0,1)}static get tiltLeft(){return new c(.707,0,0,.707)}static get tiltRight(){return new c(.707,0,0,-.707)}static fromArray(t){return new c(...t)}static fromEulers(t,e,r){const n=i(.5*e),o=i(.5*r),a=i(.5*t),u=s(.5*e),l=s(.5*r),h=s(.5*t);return new c(n*o*a-u*l*h,n*o*h+u*l*a,u*o*a+n*l*h,n*l*a-u*o*h).normalize}static fromAxisAngle(t,e){const r=1/t.len,n=s(e/2);return new c(i(e/2),n*t.x*r,n*t.y*r,n*t.z*r).normalize}static fromRotation(t,e){const r=t.add(e),n=t.cross(r),s=t.dot(r);return new c(s,n.x,n.y,n.z).normalize}constructor(t,e,r,n){this.w=t||0,this.x=e||0,this.y=r||0,this.z=n||0}get clone(){return new c(this.w,this.x,this.y,this.z)}get toArray(){return[this.w,this.x,this.y,this.z]}get toMat3(){const{w:t,x:e,y:r,z:s}=this,i=e*t,o=e*e,a=e*r,u=e*s,c=r*t,l=r*r,h=r*s,m=s*t,f=s*s;return new n.Mat3(1-2*(l+f),2*(a-m),2*(u+c),2*(a+m),1-2*(o+f),2*(h-i),2*(u-c),2*(h+i),1-2*(o+l))}get toMat4(){return this.toMat3.toMat4}get toEulers(){throw new Error("Quaternion toEuler not implemented")}get len(){return u(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)}get lenSqrt(){return this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z}get conjugate(){return new c(this.w,-this.x,-this.y,-this.z)}get normalize(){let t=u(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);return t>0?(t=1/t,new c(this.w*t,this.x*t,this.y*t,this.z*t)):new c(1,0,0,0)}get invert(){const t=1/this.len;return new c(this.w*t,-this.x*t,-this.y*t,-this.z*t)}mul(t){const e=this.w,r=this.x,n=this.y,s=this.z,i=t.w,o=t.x,a=t.y,u=t.z;return new c(e*i-r*o-n*a-s*u,r*i+e*o+n*u-s*a,n*i+e*a+s*o-r*u,s*i+e*u+r*a-n*o).normalize}dot(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z}cross(t){throw new Error(`Quaternion cross not implemented ${t}`)}scaleRotation(t){const e=o(this.w)*t,r=new n.Vec3(this.x,this.y,this.z).scale(s(e));return new c(i(e),r.x,r.y,r.z)}lerp(t,e){return e>=1?t:this.scaleRotation(1-e).multiply(t.scaleRotation(e))}nlerp(t,e){return this.lerp(t,e).normalize}slerp(t,e){if(e<=0)return this;if(e>=1)return t;let r=this.dot(t);if(a(r)>=1)return this;r<0&&(t.w=-t.w,t.x=-t.x,t.y=-t.y,t.z=-t.z,r=-r);const n=u(1-r*r);if(a(n)<.001)return new c(.5*(this.w+t.w),.5*(this.x+t.x),.5*(this.y+t.y),.5*(this.z+t.z)).normalize;const i=o(r),l=s((1-e)*i)/n,h=s(e*i)/n;return new c(this.w*l+t.w*h,this.x*l+t.x*h,this.y*l+t.y*h,this.z*l+t.z*h).normalize}}e.default=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static linear(t){return t}static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return t<.5?2*t*t:(4-2*t)*t-1}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return(t-=1)*t*t+1}static easeInOutCubic(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1-(t-=1)*t*t*t}static easeInOutQuart(t){return t<.5?8*t*t*t*t:1-8*(t-=1)*t*t*t}static easeInQuint(t){return t*t*t*t*t}static easeOutQuint(t){return 1+(t-=1)*t*t*t*t}static easeInOutQuint(t){return t<.5?16*t*t*t*t*t:1+16*(t-=1)*t*t*t*t}constructor(){throw new Error("You should not use Easing contructor...")}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(31);Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return i(n).default}});var s=r(32);function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Camera",{enumerable:!0,get:function(){return i(s).default}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(7));e.default=class extends n.default{constructor(t){super(t,"Model"),this.mesh=null,this.materials=[]}addMesh(t){this.mesh=t}addMaterial(t){this.materials.push(t)}getGeometries(){return this.mesh&&this.mesh.geometries||null}getMaterials(){return this.materials.length&&this.materials||null}update(){}remove(){this.node.removeComponent(this),this.mesh=null,this.materials.length=0}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(7)),s=r(1);const{PI:i}=Math;e.default=class extends n.default{constructor(t){super(t,"Camera"),this.active=!0,this.inControl=!0;const e=window.innerWidth/window.innerHeight;this._perspective=s.Mat4.perspective(.25*i,e,.01,1e3),this._ortographic=s.Mat4.orthographic(-e,e,-1,1,.01,1e3)}get view(){return this.node.transform.worldTransform}get perspective(){return this._perspective.clone}get ortographic(){return this._ortographic.clone}resize(){const t=window.innerWidth/window.innerHeight;this._perspective=s.Mat4.perspective(.25*i,t,.01,1e3),this._ortographic=s.Mat4.orthographic(-t,t,-1,1,.01,1e3)}update(){}remove(){this.node.removeComponent(this)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(34);Object.defineProperty(e,"firstLetterToUpper",{enumerable:!0,get:function(){return function(t){return t&&t.__esModule?t:{default:t}}(n).default}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=(t=>t.charAt(0).toUpperCase()+t.slice(1))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(36)),s=r(56);n.default.defaults.baseURL=`${window.location.origin}/api/glib`,n.default.defaults.headers.common.accept="image/png";const i=/^\.(?:obj|mtl|png|jpg|cnf|glsl)$/,o=t=>{if(!t)return new Error("No url defined.");const e=t.lastIndexOf(".");if(-1===e)return new Error(`No file extension in url. Url: ${t}`);const r=t.slice(e);return(t=>i.test(t))(r)?void 0:new Error(`Illegal file extension: ${r}`)},a=t=>{switch(t.slice(t.lastIndexOf("."))){case".obj":return new s.Mesh(t);case".mtl":return new s.Material(t);case".png":case".jpg":return new s.Texture(t);case".glsl":return new s.ShaderSource(t);case".cnf":return new s.SceneSource(t);default:throw new Error(`Unable to find resource with url: ${t}`)}};e.default=class{constructor(){this.cache=new Map,this.loadQueue=new Map,this.loading=!1,this.onLoadDone=null}getResource(t,e){const r=o(t);if(r)throw new Error(r);if(this.cache.has(t)){const r=this.cache.get(t);return e&&e(r),r}if(this.loadQueue.has(t)){const r=this.loadQueue.get(t);return e&&(r.callbacks.push(e),this.loadQueue.set(t,r)),r.resource}{const r=a(t),n=e?[e]:[];return this.loadQueue.set(r.url,{resource:r,callbacks:n}),this.loadNextResource(),r}}loadNextResource(){var t=this;return function(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(s,i){try{var o=e[s](i),a=o.value}catch(t){return void r(t)}if(!o.done)return Promise.resolve(a).then(function(t){n("next",t)},function(t){n("throw",t)});t(a)}("next")})}}(function*(){if(t.loading)return;const e=t.loadQueue.values().next().value;if(!e)return void(t.onLoadDone&&t.onLoadDone());t.loading=!0;const{resource:r,callbacks:s}=e,i=yield n.default.get(r.url);t.loadQueue.delete(r.url),t.cache.set(r.url,r);const o=r.parse(i.data);o&&o(t),s.forEach(function(t){t(r)}),t.loading=!1,t.loadNextResource()})()}deleteResource(t){t.remove(),this.cache.delete(t.url),this.loadQueue.delete(t.url)}deleteAllResources(){this.loading=!0,this.cache.forEach(t=>{t.delete()}),this.loadQueue.forEach(t=>{t.delete()}),this.cache.clear(),this.loadQueue.clear(),this.loading=!1}}},function(t,e,r){t.exports=r(37)},function(t,e,r){"use strict";var n=r(0),s=r(8),i=r(39),o=r(4);function a(t){var e=new i(t),r=s(i.prototype.request,e);return n.extend(r,i.prototype,e),n.extend(r,e),r}var u=a(o);u.Axios=i,u.create=function(t){return a(n.merge(o,t))},u.Cancel=r(12),u.CancelToken=r(54),u.isCancel=r(11),u.all=function(t){return Promise.all(t)},u.spread=r(55),t.exports=u,t.exports.default=u},function(t,e){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(r(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,r){"use strict";var n=r(4),s=r(0),i=r(49),o=r(50);function a(t){this.defaults=t,this.interceptors={request:new i,response:new i}}a.prototype.request=function(t){"string"==typeof t&&(t=s.merge({url:arguments[0]},arguments[1])),(t=s.merge(n,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[o,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},s.forEach(["delete","get","head","options"],function(t){a.prototype[t]=function(e,r){return this.request(s.merge(r||{},{method:t,url:e}))}}),s.forEach(["post","put","patch"],function(t){a.prototype[t]=function(e,r,n){return this.request(s.merge(n||{},{method:t,url:e,data:r}))}}),t.exports=a},function(t,e){var r,n,s=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var u,c=[],l=!1,h=-1;function m(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var t=a(m);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new d(t,e)),1!==c.length||l||a(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e){n.forEach(t,function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])})}},function(t,e,r){"use strict";var n=r(10);t.exports=function(t,e,r){var s=r.config.validateStatus;r.status&&s&&!s(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,s){return t.config=e,r&&(t.code=r),t.request=n,t.response=s,t}},function(t,e,r){"use strict";var n=r(0);function s(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var i;if(r)i=r(e);else if(n.isURLSearchParams(e))i=e.toString();else{var o=[];n.forEach(e,function(t,e){null!==t&&void 0!==t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),o.push(s(e)+"="+s(t))}))}),i=o.join("&")}return i&&(t+=(-1===t.indexOf("?")?"?":"&")+i),t}},function(t,e,r){"use strict";var n=r(0),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,i,o={};return t?(n.forEach(t.split("\n"),function(t){if(i=t.indexOf(":"),e=n.trim(t.substr(0,i)).toLowerCase(),r=n.trim(t.substr(i+1)),e){if(o[e]&&s.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([r]):o[e]?o[e]+", "+r:r}}),o):o}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function s(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=s(window.location.href),function(e){var r=n.isString(e)?s(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function s(){this.message="String contains an invalid character"}s.prototype=new Error,s.prototype.code=5,s.prototype.name="InvalidCharacterError",t.exports=function(t){for(var e,r,i=String(t),o="",a=0,u=n;i.charAt(0|a)||(u="=",a%1);o+=u.charAt(63&e>>8-a%1*8)){if((r=i.charCodeAt(a+=.75))>255)throw new s;e=e<<8|r}return o}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,s,i,o){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(s)&&a.push("path="+s),n.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";var n=r(0);function s(){this.handlers=[]}s.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},s.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},s.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=s},function(t,e,r){"use strict";var n=r(0),s=r(51),i=r(11),o=r(4),a=r(52),u=r(53);function c(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return c(t),t.baseURL&&!a(t.url)&&(t.url=u(t.baseURL,t.url)),t.headers=t.headers||{},t.data=s(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||o.adapter)(t).then(function(e){return c(t),e.data=s(e.data,e.headers,t.transformResponse),e},function(e){return i(e)||(c(t),e&&e.response&&(e.response.data=s(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e,r){return n.forEach(r,function(r){t=r(t,e)}),t}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(12);function s(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new n(t),e(r.reason))})}s.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},s.source=function(){var t;return{token:new s(function(e){t=e}),cancel:t}},t.exports=s},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(57);Object.defineProperty(e,"Material",{enumerable:!0,get:function(){return u(n).default}});var s=r(58);Object.defineProperty(e,"Mesh",{enumerable:!0,get:function(){return u(s).default}});var i=r(59);Object.defineProperty(e,"SceneSource",{enumerable:!0,get:function(){return u(i).default}});var o=r(60);Object.defineProperty(e,"ShaderSource",{enumerable:!0,get:function(){return u(o).default}});var a=r(61);function u(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Texture",{enumerable:!0,get:function(){return u(a).default}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(3));e.default=class extends n.default{constructor(t){super(t),this.shaderSource=null,this.shaderProgram=null,this.textures=new Map,this.defines=new Map}parse(t){return"object"!=typeof t&&JSON.parse(t),e=>{e.getResource(t.shaderSource,t=>{this.shaderSource=t});for(const e of t.defines)this.enableDefine(e,null);for(const r of t.textures){const{define:t,src:n,value:s}=r;e.getResource(n,e=>{this.addTexture(t,e)})}}}addTexture(t,e){this.textures.set(t,e)}getTextures(){const t=[];for(const e of this.textures)t.push(e);return t.length?t:null}enableDefine(t,e){this.defines.set(t,e)}getDefines(){const t=[];for(const e of this.defines)t.push(e);return t.length?t:null}remove(){this.shaderSource=null,this.shaderProgram=null,this.textures.clear(),this.defines.clear()}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),s=a(r(3)),i=a(r(6)),o=r(1);function a(t){return t&&t.__esModule?t:{default:t}}const u=t=>{const e=[];let r=0;return t.forEach(t=>{switch(t){case"a_position":e.push({name:"a_position",vertices:3,offset:r}),r+=12;break;case"a_texcoord":e.push({name:"a_texcoord",vertices:2,offset:r}),r+=8;break;case"a_normal":e.push({name:"a_normal",vertices:3,offset:r}),r+=12;break;case"a_tangent":e.push({name:"a_tangent",vertices:3,offset:r}),r+=12;break;case"a_bitangent":e.push({name:"a_bitangent",vertices:3,offset:r}),r+=12;break;default:throw new Error(`Unknown mesh attribute name: ${t}`)}}),e},c=t=>{let e=0;return t.forEach(t=>{switch(t){case"a_position":e+=12;break;case"a_texcoord":e+=8;break;case"a_normal":case"a_tangent":case"a_bitangent":e+=12;break;default:throw new Error(`Unknown mesh attribute: ${t}`)}}),e},l=(t,e,r)=>{let n=0;const s=r?9:6,o=/[a-z_]+(?:\.\w+)?/i;o.test(e[0])&&e.splice(0,1),t.push(new i.default(0,null));for(let r=0;r<e.length;r+=s)o.test(e[r])?(e.splice(r,1),t[t.length-1].vertexCount=3*n,t.push(new i.default(3*r,null)),n=0,r-=1):n+=1;t[t.length-1].vertexCount=3*n},h=(t,e,r,n)=>{if(e&&e.length>0)if(n){const n=e.length/2*3;for(let s=0;s<n;s+=9){const n=s/9;t.push(r[e[s+0]].getNormal(r[e[s+2]],r[e[s+4]])),e.splice(s+2,0,n),e.splice(s+5,0,n),e.splice(s+8,0,n)}}else{const n=2*e.length;for(let s=0;s<n;s+=6){const n=s/6;t.push(r[e[s+0]].getNormal(r[e[s+1]],r[e[s+2]])),e.splice(s+1,0,n),e.splice(s+3,0,n),e.splice(s+5,0,n)}}else{const e=r.length;for(let n=0;n<e;n+=3){const e=r[n+0].getNormal(r[n+1],r[n+2]);t.push(e,e,e)}}},m=(t,e,r,n,s)=>{const i=s.length/3*5;for(let a=0;a<i;a+=15){const i=r[s[a+0]],u=r[s[a+3]],c=r[s[a+6]],l=n[s[a+1]],h=n[s[a+4]],m=n[s[a+7]],f=u.x-i.x,d=c.x-i.x,p=u.y-i.y,g=c.y-i.y,w=u.z-i.z,y=c.z-i.z,v=h.x-l.x,b=m.x-l.x,x=h.y-l.y,_=m.y-l.y,T=1/(v*_-b*x),E=new o.Vec3((_*f-x*d)*T,(_*p-x*g)*T,(_*w-x*y)*T).normalize,A=new o.Vec3((v*d-b*f)*T,(v*g-b*p)*T,(v*y-b*w)*T).normalize;t.push(E),e.push(A);const M=a/15;s.splice(a+3,0,M,M),s.splice(a+8,0,M,M),s.splice(a+13,0,M,M)}},f=(t,e)=>{const r=n.gl.createBuffer();n.gl.bindBuffer(n.gl.ARRAY_BUFFER,r),n.gl.bufferData(n.gl.ARRAY_BUFFER,t,n.gl.STATIC_DRAW);const s=n.gl.createBuffer();return n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,s),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,e,n.gl.STATIC_DRAW),{vertexBuffer:r,indiceBuffer:s}};e.default=class extends s.default{constructor(t){super(t),this.materialSources=[],this.geometries=[],this.attributes=[],this.vertexSize=null,this.vertexBuffer=null,this.indiceBuffer=null,this.vao=null}parse(t){const e=[],r=[],n=[],s=[],i=[],a=[],d=[],p=[],g=[],w=[],y=[],v=/^(\w+) (.+)$/gm,b=/-?\d+\.\d+/g,x=/\d+/g;let _="";if("object"==typeof t){const n=t.vertexData.length;for(let s=0;s<n;s+=2)e.push(t.vertexData[s+0]),r.push(t.vertexData[s+1]);a.push(...t.indices)}else{const s={v:t=>{e.push(new o.Vec3(...t[2].match(b).map(parseFloat)))},vt:t=>{r.push(new o.Vec2(...t[2].match(b).map(parseFloat)))},vn:t=>{n.push(new o.Vec3(...t[2].match(b).map(parseFloat)).normalize)},f:t=>{a.push(...t[2].match(x).map(t=>parseInt(t,10)-1))},g:t=>{a.push(t[2]),d.push(t[2])},"#":t=>{},o:t=>{},usemtl:t=>{},s:t=>{},mtllib:t=>{}};for(;_=v.exec(t);)try{s[_[1]](_)}catch(t){throw new Error("Failed at parsing mesh file row.",_,t)}}e.length&&g.push("a_position");const T=!!r.length;if(T&&g.push("a_texcoord"),n.length||h(n,a,e,T),g.push("a_normal"),l(p,a,T),p.forEach(t=>{t.mesh=this}),T&&(m(s,i,e,r,a),g.push("a_tangent","a_bitangent")),r){const t=a.length;for(let o=0;o<t;o+=5)w.push(...e[a[o+0]].toArray),w.push(...r[a[o+1]].toArray),w.push(...n[a[o+2]].toArray),w.push(...s[a[o+3]].toArray),w.push(...i[a[o+4]].toArray),y.push(o/5)}else{const t=a.length;for(let r=0;r<t;r+=2)w.push(...e[a[r+0]].toArray),w.push(...n[a[r+2]].toArray),y.push(r/2)}const E=f(new Float32Array(w),new Uint16Array(y));this.materialSources.push(...d.map(t=>t)),this.geometries=p,this.attributes=u(g),this.vertexSize=c(g),this.vertexBuffer=E.vertexBuffer,this.indiceBuffer=E.indiceBuffer}remove(){this.geometries.forEach(t=>{t.mesh=null}),this.geometries.length=0,this.attributes.length=0,n.gl.deleteBuffer(this.vertexBuffer),n.gl.deleteBuffer(this.indiceBuffer),n.gl.deleteBuffer(this.vao),this.vertexBuffer=null,this.indiceBuffer=null,this.vao=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(r(3));e.default=class extends n.default{constructor(t){super(t),this.data=null}parse(t){this.data=t}remove(){}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),s=function(t){return t&&t.__esModule?t:{default:t}}(r(3));e.default=class extends s.default{constructor(t){super(t),this.data=null}parse(t){this.data=t}createModifiedSource(t,e){let r="#version 300 es\n";if(!t)throw new Error(`Type of shader is invalid: ${t}`);return r+=t===n.gl.VERTEX_SHADER?"#define VERTEX\n":"#define FRAGMENT\n",`${r+=e.map(([t,e])=>`#define ${t}${e?`=${e}\n`:"\n"}`).join("")}#line 1\n${this.data}`}remove(){this.data=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),s=function(t){return t&&t.__esModule?t:{default:t}}(r(3));const i=t=>{const e=t.width,r=t.height,s=n.gl.createTexture();return n.gl.bindTexture(n.gl.TEXTURE_2D,s),n.gl.texImage2D(n.gl.TEXTURE_2D,0,n.gl.RGBA,e,r,0,n.gl.RGBA,n.gl.UNSIGNED_BYTE,t),e&e-1==0&&r&r-1==0?n.gl.generateMipmap(n.gl.TEXTURE_2D):(n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_S,n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_T,n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_MIN_FILTER,n.gl.LINEAR)),s};e.default=class extends s.default{constructor(t){super(t),this.buffer=null}parse(t){const e=new Image;e.onload=(()=>{this.buffer=i(e)}),e.src=`data:image/png;base64,${t}`}remove(){n.gl.deleteBuffer(this.buffer),this.buffer=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),s=r(5),i=function(t){return t&&t.__esModule?t:{default:t}}(r(63));new Map;e.default=class{constructor(t){t.getResource("def_colormap.default.png",t=>{this.defaultTexture=t}),t.getResource("def.default.mtl",t=>{this.defaultMaterial=t}),this.resourceManager=t,this.boundScene=null,this.boundCamera=null,this.boundShaderProgram=null,this.boundMesh=null,this.boundMaterial=null,this.shaderProgramCache=new Map}renderScene(t){const e=[];t.walkEnabled(t=>{t.components.forEach(t=>{switch(t.type){case"Model":this.queueRenderable(t,e);break;case"Camera":!this.boundCamera&&t.active&&(this.boundCamera=t)}})}),n.gl.clearColor(.4,.4,.4,1),n.gl.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),this.renderPass(t,e)}queueRenderable(t,e){if(!t.mesh)return;const r=t.getGeometries(),n=t.getMaterials();if(r&&n)for(let s=0;s<r.length;s+=1)this.queueGeometry(r[s],n[s],t.node.transform.worldTransform,e)}queueGeometry(t,e,r,n){for(const s of n)if(s.geometry===t&&s.material===e)return void s.worldTransforms.push(r);n.push(new s.GeometryBatch(t,e,r))}renderPass(t,e){n.gl.frontFace(n.gl.CCW),n.gl.enable(n.gl.CULL_FACE),n.gl.enable(n.gl.DITHER),n.gl.enable(n.gl.DEPTH_TEST),n.gl.depthMask(!0);for(const r of e){const{material:e,geometry:{mesh:s,vertexCount:i,vertexOffset:o}}=r;if(this.boundMaterial!==e){if(this.boundMaterial=e,this.bindShaderProgram(),!this.boundShaderProgram)continue;this.bindMesh(s),this.bindTextures(),this.bindScene(t),this.bindCamera()}this.drawIndividual(r,n.gl.TRIANGLES,i,n.gl.UNSIGNED_SHORT,o)}this.boundScene=null,this.boundCamera=null,this.boundShaderProgram=null,this.boundMesh=null,this.boundMaterial=null}bindShaderProgram(){const{boundMaterial:t}=this;if(t.shaderProgram)return this.boundShaderProgram=t.shaderProgram,void n.gl.useProgram(this.boundShaderProgram.program);let e=t.getDefines();if(e.length||(console.error(`Material ${t.src} is missing textures, added default colormap texture`),t.enableDefine("COLORMAP",1),t.addTexture("COLORMAP",this.defaultTexture),e=t.getDefines()),!t.shaderSource)return void(this.boundShaderProgram=null);const r=i.default.createShaderKey(t.shaderSource.url,e);let s=this.shaderProgramCache.get(r);s||((s=new i.default(r,t.shaderSource,e)).compileShaderProgram(),this.shaderProgramCache.set(s.key,s)),t.shaderProgram=s,this.boundShaderProgram=s,n.gl.useProgram(s.program)}bindMesh(t){if(this.boundMesh=t,t.vao)return void n.gl.bindVertexArray(t.vao);t.vao=n.gl.createVertexArray(),n.gl.bindVertexArray(t.vao),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,t.vertexBuffer),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,t.indiceBuffer);const e=this.boundShaderProgram.attributeLocations,{attributes:r,vertexSize:s}=t;for(const t of r){const{name:r,vertices:i,offset:o}=t;n.gl.enableVertexAttribArray(e[r]),n.gl.vertexAttribPointer(e[r],i,n.gl.FLOAT,!1,s,o)}}bindTextures(){const t=this.boundShaderProgram.uniformLocations,e=this.boundMaterial.getTextures()||[["COLORMAP",this.defaultTexture]];let r=0;for(const[s,i]of e){let e;switch(s){case"COLORMAP":e=t.u_color_texture;break;case"NORMALMAP":e=t.u_normal_texture;break;case"SPECULARMAP":e=t.u_specular_texture;break;default:throw new Error(`No texture of type ${s} has been specified. Implement!`)}n.gl.activeTexture(n.gl.TEXTURE0+r),n.gl.bindTexture(n.gl.TEXTURE_2D,i.buffer),n.gl.uniform1i(e,r++)}}bindScene(t){const{u_time:e}=this.boundShaderProgram.uniformLocations;n.gl.uniform1f(e,performance.now())}bindCamera(){const{boundCamera:t}=this,{u_view:e,u_perspectice:r,u_view_inverted:s}=this.boundShaderProgram.uniformLocations;n.gl.uniformMatrix4fv(e,!1,t.view.toFloat32Array),n.gl.uniformMatrix4fv(r,!1,t.perspective.toFloat32Array),n.gl.uniformMatrix4fv(s,!1,t.view.invert.toFloat32Array)}drawIndividual(t,e,r,s,i){const{u_model:o,u_model_rotation:a,u_mvp:u,u_normal_matrix:c}=this.boundShaderProgram.uniformLocations,{view:l,perspective:h}=this.boundCamera;for(const m of t.worldTransforms)n.gl.uniformMatrix3fv(c,!1,m.toMat3.mul(l.toMat3).invert.transpose.toFloat32Array),n.gl.uniformMatrix3fv(a,!1,m.toMat3.invert.transpose.toFloat32Array),n.gl.uniformMatrix4fv(o,!1,m.toFloat32Array),n.gl.uniformMatrix4fv(u,!1,h.mul(l.invert).mul(m).toFloat32Array),n.gl.drawElements(e,r,s,2*i)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);e.default=class{static createShaderKey(t,e){return`${t}:${e.map(([t,e])=>`${t}=${e}`).join(",")}`}constructor(t,e,r){this.key=t,this.defines=r,this.shaderSource=e,this.program=null,this.attributeLocations={},this.uniformLocations={}}compileShaderProgram(){if(!this.shaderSource)throw new Error("No shadersource in shaderprogram");this.createProgram(this.createShader(n.gl.VERTEX_SHADER),this.createShader(n.gl.FRAGMENT_SHADER)),this.getAttributeLocations(),this.getUniformLocations()}createShader(t){const e=this.shaderSource.createModifiedSource(t,this.defines),r=n.gl.createShader(t);if(n.gl.shaderSource(r,e),n.gl.compileShader(r),!n.gl.getShaderParameter(r,n.gl.COMPILE_STATUS))throw new Error(`Error while creating shaderprogram: ${n.gl.getShaderInfoLog(r)}`);return r}createProgram(t,e){const r=n.gl.createProgram();if(n.gl.attachShader(r,t),n.gl.attachShader(r,e),n.gl.linkProgram(r),!n.gl.getProgramParameter(r,n.gl.LINK_STATUS))throw new Error(`Error while linking program: ${n.gl.getProgramInfoLog(r)}`);this.program=r}getAttributeLocations(){const t={},e=n.gl.getProgramParameter(this.program,n.gl.ACTIVE_ATTRIBUTES);for(let r=0;r<e;r+=1){const e=n.gl.getActiveAttrib(this.program,r).name;t[e]=n.gl.getAttribLocation(this.program,e)}this.attributeLocations=t}getUniformLocations(){const t={},e=n.gl.getProgramParameter(this.program,n.gl.ACTIVE_UNIFORMS);for(let r=0;r<e;r+=1){const e=n.gl.getActiveUniform(this.program,r).name;t[e]=n.gl.getUniformLocation(this.program,e)}this.uniformLocations=t}remove(){}}}]);